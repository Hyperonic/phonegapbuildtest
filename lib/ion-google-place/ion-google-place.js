angular.module("ion-google-place",[]).directive("ionGooglePlace",["$ionicTemplateLoader","$ionicBackdrop","$ionicPlatform","$q","$timeout","$rootScope","$document","constants","Initializer","EmployeeService","constants","toastr","$translate","$ionicScrollDelegate","AnimateMarkerService",function(e,o,t,a,r,i,n,c,s,p,c,l,d,u,f){return{require:"?ngModel",restrict:"E",template:'<input type="text" disabled readonly="readonly" class="ion-google-place" autocomplete="off">',replace:!0,scope:{ngModel:"=?",pickuppromotions:"=?",dropoffpromotions:"=?",status:"=?",showpost:"=?",callback:"&"},link:function(a,f,g,y){var h,m,k,v,_;a.locations=[];var b,w,Q,T,R,S,E,O,P,L,I,N,x,A=a.$on("gmaps:loaded",function(){s.mapsInitialized().then(function(){void 0==b&&(b=new google.maps.places.AutocompleteService),void 0==L&&(L=new google.maps.places.PlacesService(I[0]))})}),C=['<div class="ion-google-place-container modal">','<ion-header-bar class="bar bar-header bar-positive bar-custom">','<backbutton ng-click="close()"></backbutton>',"<h1 class=\"title\">{{ 'SET_ROUTE' | translate }}</h1>",'<div ng-if="pickupLocationSelected && dropoffLocationSelected" class="button button-clear" ng-click="save()">','<span class="icon ion-checkmark"></span>',"</div>","</ion-header-bar>",'<ion-content class="custom-radio has-fixedbtn">','<form novalidate="novalidate" autocomplete="off">','<label ng-click="publishClicked()" ng-if="dispatcherPage && showpost" class="custom-checkbox item item-checkbox">','<div class="checkbox checkbox-input-hidden checkbox-circle">','<input type="checkbox" name="disclaimer" ng-model="searchQuery.type" ng-true-value="1" ng-false-value="0" ><i class="checkbox-icon"></i></div>',"<div class=\"item-content item-text-wrap\">{{'ROUTE_PUBLISHABLE' | translate}}</div>","</label>",'<div class="list">','<div ng-if="searchQuery.type" class="list list-inset cont-list">','<div class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<i class="mr10 icon ion-location"></i>','<input class="google-place-search pickup" type="search" ng-model="searchQuery.pickup_type_name" placeholder="{{\'PICKUP_TYPE_NAME\' | translate}}">',"</label>",'<span ng-click="clearType(\'pickup\')" ng-class="{\'ion-ios-close rt35\' : searchQuery.pickup_type_name}" class="searchicon button button-clear ft25"></span>',"<span ng-if=\"searchQuery.pickup_type_name\" ng-click=\"setType('pickup')\" ng-class=\"{'ion-android-arrow-dropup': showpickuptype, 'ion-android-arrow-dropdown' : !showpickuptype, 'blink_me': !searchQuery.pickupType && !showpickuptype}\" class=\"button button-clear icon dropdown-icon typedropdown\"></span>","</div>",'<ion-list ng-show="showpickuptype">',"<p>{{'LOCATION_TYPE'|translate}}</p>",'<ion-item class="chkbox-list-item" ng-repeat="type in pickuptypes" type="item-text-wrap" ng-click="selectType(type, \'pickup\')">',"{{type.name}}","<i ng-class=\"type.checked ? 'radio-icon ion-checkmark' : 'icon ion-ios-circle-outline not-checked'\"></i>","</ion-item>","</ion-list>","</div>",'<div ng-if="searchQuery.type" class="form-errors" ng-show="(!searchQuery.pickup_type_name || searchQuery.pickup_type_name && !searchQuery.pickupType) && saved" ng-messages="{\'required\': !searchQuery.pickup_type_name, \'sel_type\': searchQuery.pickup_type_name && !searchQuery.pickupType}">','<div class="form-error" ng-message="required">{{\'PLEASE_ENTER_NAME\'|translate}}</div>',"<div class=\"form-error\" ng-message-exp=\"['sel_type']\">{{'LOCATION_TYPE'|translate}}</div>","</div>",'<div class="list list-inset cont-list">','<div ng-if="inbox_status != \'load\'" class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<b><img src="img/markerA.png"></b>','<input class="google-place-search pickup" type="search" ng-model="searchQuery.pickup" placeholder="'+(g.placeholderpickup||"Enter an address, place or ZIP code")+'">',"</label>","<span ng-click=\"clearSearch('pickup')\" ng-class=\"{'ion-ios-close' : searchQuery.pickup.length > 0, 'ion-search': searchQuery.pickup.length < 1, 'rt5': pickuptyped || !($root.pois != null && $root.pois.length > 0)}\" class=\"searchicon button button-clear ft25\"></span>",'<span ng-show="$root.pois != null && $root.pois.length > 0 && !pickuptyped" ng-click="$parent.$parent.pickupdropdownclicked = !$parent.$parent.pickupdropdownclicked" class="ion-location button button-clear ft25"></span>',"</div>",'<ion-list ng-show="pickuptyped">','<ion-item ng-repeat="location in pickuplocations" type="item-text-wrap" ng-click="selectLocation(location, \'pickup\')">','<i class="mr5 icon ion-location"></i>{{location.formatted_address}}',"</ion-item>","</ion-list>",'<ion-list ng-show="pickuptyped || $parent.pickupdropdownclicked">','<ion-item ng-if="$root.pois.length > 0" class="item-divider" type="item-text-wrap">',"{{'POINTS_INTEREST' | translate}}","</ion-item>",'<ion-item ng-repeat="promotion in $root.pois" type="item-text-wrap" ng-click="selectPOILocation(promotion, \'pickup\')">','<i class="mr5 icon ion-location"></i>{{promotion.address}}',"</ion-item>","</ion-list>","</div>",'<div ng-if="searchQuery.type" class="list list-inset cont-list">','<div class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<i class="mr10 icon ion-location"></i>','<input class="google-place-search pickup" type="search" ng-model="searchQuery.dropoff_type_name" placeholder="{{\'DROPOFF_TYPE_NAME\' | translate}}">',"</label>",'<span ng-click="clearType(\'dropoff\')" ng-class="{\'ion-ios-close  rt35\' : searchQuery.dropoff_type_name}" class="searchicon button button-clear ft25"></span>',"<span ng-if=\"searchQuery.dropoff_type_name\" ng-click=\"setType('dropoff')\" ng-class=\"{'ion-android-arrow-dropup': showdropofftype, 'ion-android-arrow-dropdown' : !showdropofftype, 'blink_me': !searchQuery.dropoffType && !showdropofftype}\" class=\"button button-clear icon dropdown-icon typedropdown\"></span>","</div>",'<ion-list ng-show="showdropofftype">',"<p>{{'LOCATION_TYPE'|translate}}</p>",'<ion-item class="chkbox-list-item" ng-repeat="type in dropofftypes" type="item-text-wrap" ng-click="selectType(type, \'dropoff\')">',"{{type.name}}","<i ng-class=\"type.checked ? 'radio-icon ion-checkmark' : 'icon ion-ios-circle-outline not-checked'\"></i>","</ion-item>","</ion-list>","</div>",'<div ng-if="searchQuery.type" class="form-errors" ng-show="(!searchQuery.dropoff_type_name || searchQuery.dropoff_type_name && !searchQuery.dropoffType) && saved" ng-messages="{\'required\': !searchQuery.dropoff_type_name, \'sel_type\': searchQuery.dropoff_type_name && !searchQuery.dropoffType}">','<div class="form-error" ng-message="required">{{\'PLEASE_ENTER_NAME\'|translate}}</div>',"<div class=\"form-error\" ng-message-exp=\"['sel_type']\">{{'LOCATION_TYPE'|translate}}</div>","</div>",'<div class="list list-inset cont-list">','<div ng-hide="(pickuplocations.length > 0 && pickuptyped) || $parent.pickupdropdownclicked" style="border-bottom: none;" class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<b><img src="img/markerB.png"></b>','<input class="google-place-search dropoff" type="search" ng-model="searchQuery.dropoff" placeholder="'+(g.placeholderdropoff||"Enter an address, place or ZIP code")+'">',"</label>","<span ng-click=\"clearSearch('dropoff')\" ng-class=\"{'ion-ios-close' : searchQuery.dropoff.length > 0, 'ion-search': searchQuery.dropoff.length < 1, 'rt5': dropofftyped || !($root.pois != null && $root.pois.length > 0)}\" class=\"searchicon button button-clear ft25\"></span>",'<span ng-show="$root.pois != null && $root.pois.length > 0 && !dropofftyped" ng-click="$parent.dropoffdropdownclicked = !$parent.dropoffdropdownclicked" class="ion-location button button-clear ft25"></span>',"</div>",'<ion-list ng-show="dropofftyped && !pickuptyped && !$parent.pickupdropdownclicked">','<ion-item ng-repeat="location in dropofflocations" type="item-text-wrap" ng-click="selectLocation(location, \'dropoff\')">','<i class="mr5 icon ion-location"></i>{{location.formatted_address}}',"</ion-item>","</ion-list>",'<ion-list ng-show="dropofftyped || $parent.dropoffdropdownclicked && !pickuptyped && !$parent.pickupdropdownclicked">','<ion-item ng-if="$root.pois.length > 0" class="item-divider" type="item-text-wrap">',"{{'POINTS_INTEREST' | translate}}","</ion-item>",'<ion-item ng-repeat="promotion in $root.pois" type="item-text-wrap" ng-click="selectPOILocation(promotion, \'dropoff\')">','<i class="mr5 icon ion-location"></i>{{promotion.address}}',"</ion-item>","</ion-list>","</div>",'<div class="modal-list-items bar item-input-inset">','<label class="item-input-wrapper">','<i class="mr10 icon ion-pricetag"></i>','<input class="google-place-search pickup" type="search" ng-model="searchQuery.coupon" placeholder="{{\'ENTER_COUPON\' | translate}}">',"</label>",'<span ng-click="clearType(\'coupon\')" ng-class="{\'ion-ios-close rt5\' : searchQuery.coupon}" class="searchicon button button-clear ft25"></span>',"</div>","<div ng-if=\"!validCoupon\" class=\"form-errors\" ng-messages=\"{'incorrect_code': invalid_reason == 'code', 'no_drivers': invalid_reason == 'driver', 'not_in_range': invalid_reason == 'range'}\">","<div class=\"form-error\" ng-message-exp=\"['incorrect_code']\">{{'INVALID_COUPON'|translate}}</div>","<div class=\"form-error\" ng-message-exp=\"['no_drivers']\">{{'COUPON_NO_DRIVERS'|translate}}</div>","<div class=\"form-error\" ng-message-exp=\"['not_in_range']\">{{'COUPON_NOT_IN_RANGE'|translate}}</div>","</div>",'<div ng-if="searchQuery.type" class="clock item item-input">','<i class="ordericons icon ion-clock placeholder-icon"></i>','<date-picker ng-model="searchQuery.post_expire" heading="{{ \'POST_EXPIRES\' | translate }}" renderafter callback="saveDateTime(selDate)" is-icon=\'false\'>',"</date-picker>",'<span ng-click="clearType(\'post_expire\')" ng-class="{\'ion-ios-close\' : searchQuery.post_expire}" class="button button-clear ft25"></span>',"</div>",'<div ng-if="searchQuery.type" class="form-errors" ng-show="!searchQuery.post_expire && saved" ng-messages="{\'required\': !searchQuery.post_expire}">','<div ng-messages-include="form-errors.html"></div>',"</div>",'<div ng-if="dispatcherPage" class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<i class="mr10 icon ion-social-usd"></i>','<input class="google-place-search price" placeholdfix type="number" min="0" value="0.00" step="0.01" ng-model="searchQuery.price" placeholder="{{ \'QUOTE_PRICE\' | translate }}">',"</label>","</div>",'<div class="list list-inset cont-list">','<div ng-click="showRange()" ng-if="inbox_status != \'load\'" class="modal-list-items bar item-input-inset search-bar">','<label class="item-input-wrapper">','<i class="mr10 icon ion-pinpoint"></i>','<input readonly class="google-place-search" type="search" ng-model="searchQuery.driverrange" placeholder="'+(g.placeholderradius||"Enter an address, place or ZIP code")+'">',"</label>",'<span class="ion-android-arrow-dropdown button button-clear ft25"></span>',"</div>",'<ion-list ng-show="showRangeList">','<ion-item class="chkbox-list-item" ng-class="{\'greyListText\': arr.length < 1 && lastRangeAvailable(gpsRanges), \'selectedListItem\':isSelectedRange(key)}" ng-click="setRange(key,gpsRanges[key])" ng-repeat="key in keys(gpsRanges)" type="item-text-wrap">',"{{key}} miles","<i ng-class=\"isSelectedRange(key) ? 'radio-icon ion-checkmark' : 'icon ion-ios-circle-outline not-checked'\"></i>","</ion-item>","</ion-list>","</div>","</div>","</form>","</ion-content>",'<div class="fixedbtn custom-radio row text-center">','<div class="col">','<button btnfunc="save()" class="icon-right ion-chevron-right tooltip register-btn button app-btn yellow">{{ \'SET\' |translate}}</button>',"</div>","</div>",'<custom-footer ng-if="shown"/>',"</div>"].join(""),D=e.compile({template:C,scope:a,appendTo:n[0].body});D.then(function(e){I=angular.element(e.element.find("input")),a.showpickuptype=!1,a.showdropofftype=!1,a.saved=!1,s.mapsInitialized().then(function(){b=new google.maps.places.AutocompleteService,L=new google.maps.places.PlacesService(I[0])});var n={},g={};a.inbox_status=a.status,a.pickuptypes=[],a.dropofftypes=[],a.dispatcherPage="app.employee-dispatcher"==i.history.currentStateName(),a.dispatcherPage&&d(["AIRPORTS","APARTMENTS","ARTS_CULTURE","BARS","BUS_STATIONS","COFFEE_SHOPS","CHURCHES","COLLEGES","CONVENTION","HOSPITALS","HOTELS","INTERSECTIONS","MALLS","OFFICE","PARKS","POI","RETAIL","TRAIN","UNIVERSITIES","OTHER"]).then(function(e){for(var o in e)a.pickuptypes.push({name:e[o],checked:!1}),a.dropofftypes.push({name:e[o],checked:!1})}),a.keys=function(e){return e?Object.keys(e).sort(function(e,o){return e-o}):[]},a.resize=function(){u.resize(),u.scrollTop(!0)},a.publishClicked=function(){a.clearType("all"),a.resize()},a.setType=function(e){"pickup"==e?a.showpickuptype=!a.showpickuptype:a.showdropofftype=!a.showdropofftype,a.resize()},a.selectType=function(e,o){"pickup"==o?(a.showpickuptype=!a.showpickuptype,a.searchQuery.pickupType=e.name,a.pickuptypes.forEach(function(o){o.checked=o.name==e.name})):(a.showdropofftype=!a.showdropofftype,a.searchQuery.dropoffType=e.name,a.dropofftypes.forEach(function(o){o.checked=o.name==e.name})),a.resize()},a.clearType=function(e){"all"==e?(a.searchQuery.pickupType=null,a.searchQuery.dropoffType=null,a.searchQuery.post_expire=null,a.searchQuery.pickup_type_name=null,a.searchQuery.dropoff_type_name=null,a.pickuptypes.forEach(function(e){e.checked=!1}),a.dropofftypes.forEach(function(e){e.checked=!1}),a.showpickuptype=!1,a.showdropofftype=!1,a.resize()):"pickup"==e?(a.searchQuery.pickupType=null,a.searchQuery.pickup_type_name=null,a.pickuptypes.forEach(function(e){e.checked=!1}),a.showpickuptype=!1,a.resize()):"dropoff"==e?(a.searchQuery.dropoffType=null,a.searchQuery.dropoff_type_name=null,a.dropofftypes.forEach(function(e){e.checked=!1}),a.showdropofftype=!1,a.resize()):"post_expire"==e?a.searchQuery.post_expire=null:(a.searchQuery.coupon=null,a.validCoupon=!0)},a.saveDateTime=function(e){var o=moment(new Date(e)).format("MM/DD/YY"),t=moment(new Date(e)).format("hh:mm a");a.searchQuery.post_expire=o+" "+t},a.selectLocation=function(e,o){if(void 0!=e.geometry){if(0==Object.keys(n).length)var t=angular.copy(y.$modelValue);else var t=n;var t=n;t.hasOwnProperty(o+"_lat")?(t[o+"_lat"]=e.geometry.location.lat(),t[o+"_lon"]=e.geometry.location.lng(),t[o]=e.formatted_address):(t[o]={},t[o].lat=e.geometry.location.lat(),t[o].lon=e.geometry.location.lng(),t[o].formatted_address=e.formatted_address),n=t,g[o]={},g[o].lat=e.geometry.location.lat(),g[o].lon=e.geometry.location.lng(),g[o].formatted_address=e.formatted_address,"pickup"==o?i.$broadcast("location:searched",g):(a[o+"LocationSelected"]=!0,a[o+"typed"]=!1,a[o+"dropdownclicked"]=!1,a.searchQuery[o]=e.formatted_address,a[o+"SelectedLocation"]=e.formatted_address),u.scrollTop(!0),0==a.gpsRanges[a.searchQuery.driverrange.replace(/\D/g,"")].length&&(a.searchQuery.driverrange=a.defaultRange())}},w=i.$on("search:location",function(e,o){if(D)D=!1,o&&o.coupon?(i.$broadcast("validcoupon",C),a.close(),i.$broadcast("loading:hide")):(a.invalid_reason="driver",a.validCoupon=!1,i.$broadcast("loading:hide"));else{if(a.pickuptyped=!1,null==o)return $(".google-place-search")[0].focus(),void(g.pickup=y.$modelValue.pickup);a.pickupLocationSelected=!0,a.pickupdropdownclicked=!1,a.searchQuery.pickup=o.formatted_address,a.pickupSelectedLocation=o.formatted_address,!v&&_&&(v=!0,a.save())}}),Q=i.$on("range:out",function(o,t){"none"==e.element.css("display")&&(d(["NO_DRIVER_INRANGE"]).then(function(e){l.error(e.NO_DRIVER_INRANGE,e.SORRY)}),g.range=null,a.searchQuery.driverrange=a.defaultRange())}),T=i.$on("quotesent",function(e,o){a.searchQuery.price=null,a.clearType("all")}),P=a.$watch(function(){return p.getGpsRanges()},function(e){e&&g.range&&0==e[g.range].length&&(d(["NO_DRIVER_INRANGE"]).then(function(e){l.error(e.NO_DRIVER_INRANGE,e.SORRY)}),g.range=null,a.searchQuery.driverrange=a.defaultRange())},!0),a.isSelectedRange=function(e){return a.searchQuery.driverrange?a.searchQuery.driverrange.replace(/[^0-9.]/g,"")==e:!1},a.lastRangeAvailable=function(e){var o=e[Object.keys(e)[Object.keys(e).length-1]];return o.length>0},a.defaultRange=function(){var e;return Object.keys(a.gpsRanges).sort(function(e,o){return parseInt(o)<parseInt(e)}).some(function(o){return a.gpsRanges[o].length>0&&o>=c.defaultMilesRadius?(e="Drivers within "+o+" miles",!0):void 0}),e||"Drivers within "+c.defaultMilesRadius+" miles"},a.selectPOILocation=function(e,o){if(0==Object.keys(n).length)var t=angular.copy(y.$modelValue);else var t=n;t.hasOwnProperty(o+"_lat")?(t[o+"_lat"]=e.lat,t[o+"_lon"]=e.lng,t[o]=e.address):(t[o]={},t[o].lat=e.lat,t[o].lon=e.lng,t[o].formatted_address=e.address),n=t,g[o]={},g[o].lat=e.lat,g[o].lon=e.lng,g[o].formatted_address=e.address,"pickup"==o?i.$broadcast("location:searched",g):(a[o+"LocationSelected"]=!0,a[o+"typed"]=!1,a[o+"dropdownclicked"]=!1,a[o+"SelectedLocation"]=e.address,a.searchQuery[o]=e.address)};var A=function(e,o){for(var t=[],r=0;r<e.length;r++)!function(e,r){L.getDetails({placeId:e},function(e,n){e&&(e.formatted_address=r,t.push(e),t.sort(function(e,o){return distA=p.getGPSDistance(e.geometry.location.lat(),e.geometry.location.lng(),i.lat,i.lon),distB=p.getGPSDistance(o.geometry.location.lat(),o.geometry.location.lng(),i.lat,i.lon),distA-distB}),a.$apply(function(){a[o+"locations"]=t}))})}(e[r].place_id,e[r].description)};a.searchQuery={},a.gpsRanges=p.getGpsRanges(),a.validCoupon=!0;var C,D=!1;a.validateCoupon=function(){i.$broadcast("loading:show",{text:"VALIDATING_COUPON"}),p.coupon(a.searchQuery.coupon).then(function(e){"Success"==e.status?(C=JSON.parse(e.data.settings),n.group_name&&C.group_name!=n.group_name?(a.invalid_reason="code",a.validCoupon=!1,i.$broadcast("loading:hide")):p.getGPSDistance(C.pickup_lat,C.pickup_lon,i.lat,i.lon)>1?(a.invalid_reason="range",a.validCoupon=!1,i.$broadcast("loading:hide")):(D=!0,i.$broadcast("location:searched",{pickup:{lat:C.pickup_lat,lon:C.pickup_lon,coupon:!0}}))):(a.invalid_reason="code",a.validCoupon=!1,i.$broadcast("loading:hide"))})},O=a.$watch("searchQuery.pickup",function(e){e?e.trim()!=a.pickupSelectedLocation&&a.findplaces(e,"pickup"):a.reset("pickup")}),E=a.$watch("searchQuery.dropoff",function(e){e?e.trim()!=a.dropoffSelectedLocation&&a.findplaces(e,"dropoff"):a.reset("dropoff")}),a.showRangeList=!1,a.showRange=function(){u.resize(),a.showRangeList=!a.showRangeList},a.setRange=function(e,o){o.length<1||(a.searchQuery.driverrange="Drivers within "+e+" miles",g.range=e,a.showRangeList=!1,u.resize())},a.reset=function(e){a[e+"locations"]=[],a[e+"typed"]=!1,a[e+"LocationSelected"]=!1},a.findplaces=function(o,t){a[t+"LocationSelected"]=!1,x=r(function(){"none"!=e.element.css("display")&&(a[t+"typed"]=!0),o.length<3;var r=a.geocodeOptions||{};r.address=o,r.componentRestrictions={country:i.country};var n={};n.input=o,n.location=new google.maps.LatLng(i.lat,i.lon),n.radius=1e3*c.milesRadius*1.609,b&&b.getPlacePredictions(n,function(e,o){o==google.maps.places.PlacesServiceStatus.OK&&A(e,t)})},350)},R=a.$on("markerPos",function(o,t){n=angular.copy(y.$modelValue),"none"==e.element.css("display")&&(a.searchQuery[t.type]=t.address)}),S=a.$on("posFetched",function(e,o){k()}),N=a.$on("hide:gplace",function(e,o){a.close()}),a.pickupLocationSelected=a.dropoffLocationSelected=!1,k=function(o,c){i.setLocalNotif(),a.validCoupon=!0,a.shown=!0,v=!1,_=!1,a.saved=!1,o&&(o.preventDefault(),o.stopPropagation()),a.gpsRanges=p.getGpsRanges(),a.searchQuery.driverrange=a.searchQuery.driverrange||a.defaultRange(),a.pickuptyped=!1,a.dropofftyped=!1,a.pickupdropdownclicked=a.dropoffdropdownclicked=!1,a.pickupSelectedLocation=a.dropoffSelectedLocation="",n=angular.copy(y.$modelValue),n.hasOwnProperty("pickup")&&(a.pickupLocationSelected=!0,r(function(){a.pickupSelectedLocation=a.searchQuery.pickup="string"==typeof n.pickup?n.pickup:n.pickup.formatted_address}),g.pickup={},g.pickup.lat="string"==typeof n.pickup?n.pickup_lat:n.pickup.lat,g.pickup.lon="string"==typeof n.pickup?n.pickup_lon:n.pickup.lon,g.pickup.formatted_address="string"==typeof n.pickup?n.pickup:n.pickup.formatted_address),n.hasOwnProperty("dropoff")&&(a.dropoffLocationSelected=!0,a.dropoffSelectedLocation=a.searchQuery.dropoff="string"==typeof n.dropoff?n.dropoff:n.dropoff.formatted_address,g.dropoff={},g.dropoff.lat="string"==typeof n.dropoff?n.dropoff_lat:n.dropoff.lat,g.dropoff.lon="string"==typeof n.dropoff?n.dropoff_lon:n.dropoff.lon,g.dropoff.formatted_address="string"==typeof n.dropoff?n.dropoff:n.dropoff.formatted_address),n.hasOwnProperty("price")&&n.price&&(g.price=n.price,a.searchQuery.price=g.price),n.hasOwnProperty("range")&&n.range&&"null"!=n.range&&(g.range=n.range,a.searchQuery.driverrange="Drivers within "+g.range+" miles"),t.onHardwareBackButton(V),e.element.css({display:"block","pointer-events":"auto"}),c&&("range"==c?a.showRange():a.clearSearch(c)),i.$broadcast("setmapclick",!1)},a.clearSearch=function(o){a.searchQuery[o]="",setTimeout(function(){$(e.element).find("."+o)[0].focus(),ionic.Platform.isWebView()&&!cordova.plugins.Keyboard.isVisible&&cordova.plugins.Keyboard.show()},0)};var V=function(a){o.release(),e.element.css("display","none"),i.$broadcast("queue:updated",null,"updated"),P&&P(),n={},h&&(h(),h=null),t.offHardwareBackButton(V),ionic.Platform.isWebView()&&cordova.plugins.Keyboard.close(),i.$broadcast("setmapclick",!0),i.clearNotifIntv()};a.close=function(){V()},a.save=function(){if(a.searchQuery.coupon&&a.searchQuery.coupon.trim().length>0)return void a.validateCoupon();if(a.saved=!0,!a.searchQuery.type||a.searchQuery.pickupType&&a.searchQuery.dropoffType&&a.searchQuery.post_expire){if(_=!0,!v)return void i.$broadcast("location:searched",g);o.release(),e.element.css("display","none"),P&&P(),a.searchQuery.type&&(g.pickup_type=a.searchQuery.pickupType,g.pickup_type_name=a.searchQuery.pickup_type_name,g.dropoff_type=a.searchQuery.dropoffType,g.dropoff_type_name=a.searchQuery.dropoff_type_name,g.post_expire=a.searchQuery.post_expire),g.range=g.range||a.searchQuery.driverrange.replace(/\D/g,"")||a.defaultRange()&&a.defaultRange().replace(/\D/g,"")||c.defaultMilesRadius,g.price=a.searchQuery.price||c.defaultPrice,a.callback({selVal:g}),p.getTimeZone(g.pickup.lat,g.pickup.lon).then(function(e){document.querySelector(".datetimepicker")&&angular.element(document.querySelector(".datetimepicker")).controller("ngModel").$render(e.timeZoneId),g.timezone=e.timeZoneId}),a.pickuptyped=!1,a.dropofftyped=!1,r(function(){y.$modelValue.hasOwnProperty("pickup")&&(a.searchQuery.pickup="string"==typeof y.$modelValue.pickup?y.$modelValue.pickup:y.$modelValue.pickup.formatted_address),y.$modelValue.hasOwnProperty("dropoff")&&(a.searchQuery.dropoff="string"==typeof y.$modelValue.dropoff?y.$modelValue.dropoff:y.$modelValue.dropoff.formatted_address)},1e3),n={},h&&(h(),h=null),t.offHardwareBackButton(V),ionic.Platform.isWebView()&&cordova.plugins.Keyboard.close(),i.$broadcast("setmapclick",!0)}},closeOnBackButton=function(t){t.preventDefault(),e.element.css("display","none"),o.release(),h&&(h(),h=null)},m="LABEL"==f.parent()[0].tagName?f.parent():f.parent().parent(),m.bind("click",k),m.bind("touchend",k)}),g.placeholder&&f.attr("placeholder",g.placeholder),y.$formatters.unshift(function(e){return e?e:""}),y.$parsers.unshift(function(e){return e}),y.$render=function(){y.$viewValue?f.val(y.$viewValue.formatted_address||""):f.val("")},a.$on("$destroy",function(){h&&(h(),h=null),m&&k&&(m.bind("click",k),m.bind("touchend",k)),w&&w(),Q&&Q(),T&&T(),R&&R(),S&&S(),A&&A(),E&&E(),O&&O(),P&&P(),N&&N()})}}}]);