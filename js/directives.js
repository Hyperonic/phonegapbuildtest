angular.module("directory.directives",["ionic"]).directive("scrollDetector",["$window","$ionicScrollDelegate",function(e,t){return{restrict:"A",link:function(e,n,i){var o=n[0].querySelector(".scroll");n.on("scroll",function(){t.getScrollView(o)})}}}]).directive("nativeTransition",["$ionicGesture","$ionicPlatform",function(e,t){return{restrict:"A",link:function(n,i,o){e.on("tap",function(e){if(ionic.Platform.isWebView()){var n=o.direction||"left",i=o.transitiontype||"slide";t.ready(function(){switch(i){case"slide":window.plugins.nativepagetransitions.slide({direction:n},function(e){},function(e){alert("error: "+e)});break;case"flip":window.plugins.nativepagetransitions.flip({direction:n},function(e){},function(e){alert("error: "+e)});break;case"fade":window.plugins.nativepagetransitions.fade({},function(e){},function(e){alert("error: "+e)});break;default:window.plugins.nativepagetransitions.slide({direction:n},function(e){},function(e){alert("error: "+e)})}})}},i)}}}]).directive("onValidSubmit",["$parse","$timeout",function(e,t){return{require:"^form",restrict:"A",link:function(t,n,i,o){o.$submitted=!1;var r=e(i.onValidSubmit);n.on("submit",function(e){t.$apply(function(){n.addClass("ng-submitted"),o.$submitted=!0,o.$valid&&"function"==typeof r&&r(t,{$event:e})})}),t.$on("$destroy",function(){n.off("submit")})}}}]).directive("nksOnlyNumber",function(){return{restrict:"EA",require:"ngModel",link:function(e,t,n,i){e.$watch(n.ngModel,function(e,t){var o=String(e).split("");if("false"==n.allowNegative&&"-"==o[0]&&(e=e.toString().replace("-",""),i.$setViewValue(e),i.$render()),"false"==n.allowDecimal&&(e=parseInt(e),i.$setViewValue(e),i.$render()),"false"!=n.allowDecimal&&n.decimalUpto){var r=String(e).split(".");if(r[1]){var a=r[1].slice(0,n.decimalUpto);e=[r[0],a].join("."),i.$setViewValue(e),i.$render()}}0!==o.length&&(1!==o.length||"-"!=o[0]&&"."!==o[0])&&(2!==o.length||"-."!==e)&&isNaN(e)&&void 0!=e&&(i.$setViewValue(t),i.$render())})}}}).directive("validated",["$parse",function(e){return{restrict:"AEC",require:"^form",link:function(e,t,n,i){for(var o=t.find("*"),r=0;r<o.length;r++)!function(n){var o=n.attributes;if(void 0!=o.getNamedItem("ng-model")&&void 0!=o.getNamedItem("name")){var r=i[o.name.value];void 0!=r&&e.$watch(function(){return i.$submitted+"_"+r.$valid},function(){if(1==i.$submitted){var e=angular.element(n);e.hasClass("ng-invalid")?(t.removeClass("has-success"),t.addClass("has-error")):t.removeClass("has-error").addClass("has-success")}})}}(o[r])}}}]).directive("placeholdfix",function(){return{restrict:"A",link:function(e,t,n){ionic.Platform.isAndroid()&&(t[0].type="text",t.bind("blur",function(e){e.target.type="text"}),t.bind("focus",function(e){e.target.type="number"}),e.$on("$destroy",function(){t.unbind()}))}}}).directive("map",["MapServ","$ionicPlatform","EmployeeService","baseUrl","$timeout","$interval","$rootScope","Initializer",function(e,t,n,i,o,r,a,l){var s,c,d,u,m;return d=document.createElement("div"),d.id="googleMapWrapper",document.body.appendChild(d),c=0,s={},{restrict:"EA",scope:{onCreate:"&",latlon:"=",circles:"=?",markers:"=",mapCentered:"=",centermap:"=",gmap:"=?",mapopt:"=?"},link:function(r,l,p){var f,g,h,v,y,w,k,b,C,x,M,D,S={},T={},E={},I={},O={},A=[],P=[],V=[],F=[],L=function(e){for(var t in T)T[t].close()},z=function(){if(!ionic.Platform.isWebView()){var e=a.map.getCenter(),t=a.map.getZoom();a.map.setZoom(t-1),a.map.setZoom(t),google.maps.event.trigger(a.map,"resize"),a.map.setCenter(e)}},q=!1;a.smallScreen=window.innerHeight<700;var R=function(e){var t=(document.getElementById("mobmap"),{backgroundColor:"transparent",controls:{compass:!0,myLocationButton:!0,indoorPicker:!0,zoom:!0,pan:!0},gestures:{scroll:!0,tilt:!0,rotate:!0,zoom:!0}});m=plugin.google.maps.Map.getMap(e,t),a.map=m,m.on(plugin.google.maps.event.MAP_READY,W)},W=function(){q=!0,a.mapid="quotemap",l[0].appendChild(f),j&&a.setMapClass(j),m.refreshLayout(),m.setVisible(!0),a.map.moveCamera({target:new plugin.google.maps.LatLng(a.lat,a.lon),zoom:13},function(){})},N=function(){if(a.map||m)return void z();if(k=r.latlon&&(r.latlon.lat||r.latlon.pickup_lat)||a.lat,b=r.latlon&&(r.latlon.lon||r.latlon.pickup_lon)||a.lon,u={center:new google.maps.LatLng(k,b),zoom:14,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},mapTypeControl:!1,panControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,maxZoom:17,minZoom:6},0===d.children.length){if(c++,f=document.createElement("div"),f.dataset.mapId=c,f.style.width="100%",f.style.height="100%",f.classList.add("map"),ionic.Platform.isWebView())return void R(f);a.map=s[c]=new google.maps.Map(f,u),google.maps.event.addListener(a.map,"dragend",function(){a.mapCentered=!1}),google.maps.event.addListener(a.map,"click",L)}else{if(f=d.children[0],ionic.Platform.isWebView())return a.map=m,a.mapid="quotemap",l[0].appendChild(f),void(j&&a.setMapClass(j));a.map=s[f.dataset.mapId],a.map.setOptions(u)}if(r.gmap&&(r.gmap.map=g,a.$broadcast("gmaps:loaded")),a.mapid="quotemap",a.setMapClass(a.mapclass),l[0].appendChild(f),z(),google.maps.event.addDomListener(window,"resize",function(){a.smallScreen=window.innerHeight<700,z()}),j&&a.setMapClass(j),l[0].addEventListener("DOMNodeRemovedFromDocument",function(){d.appendChild(l[0].children[0])}),google.maps.event.addListener(a.map,"idle",function(){q=!0}),o(function(){q||$(".map").children().first().is(":empty")&&(new google.maps.Map($(".map")[0],u),o(function(){z()}))},2e3),M=new google.maps.DirectionsService,D=new google.maps.DirectionsRenderer({suppressMarkers:!0,preserveViewport:!0}),angular.isDefined(p.showDirections)){var e=new google.maps.LatLng(r.latlon.pickup_lat,r.latlon.pickup_lon),t=new google.maps.LatLng(r.latlon.dropoff_lat,r.latlon.dropoff_lon);new google.maps.Marker({position:e,map:a.map,icon:"img/markerA.png",labelContent:"A"}),new google.maps.Marker({position:t,map:a.map,icon:"img/markerB.png",labelContent:"B"});var n={origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.IMPERIAL};M.route(n,function(e,t){t==google.maps.DirectionsStatus.OK&&D.setDirections(e)}),D.setMap(a.map)}r.onCreate({map:a.map}),r.$emit("mapset"),_={url:i.replace("/api/","/assets/")+"/img/markers/transportation/town_car.png",scaledSize:new google.maps.Size(21,34)},r.centerGmap=r.centermap||{},h=a.$on("zonemap:updated",function(){r.setCircleColors()})};a.setDirections=function(t){ionic.Platform.isWebView()?(F.forEach(function(t){e.removeDirections(t)}),F.length=0,e.addDirections(t,function(e){F.push(e)})):(D.setDirections(t),D.setMap(a.map))};var _;r.setMarkers=function(t,o){a.map&&(S[t]?e.updateMarker(S[t],{lat:Number(o.lat),lng:Number(o.lng)}):A.indexOf(t)<0&&(_={url:i.replace("/api/","/assets/")+"/img/markers/transportation/town_car.png",scaledSize:new google.maps.Size(21,34),size:{width:21,height:34}},e.addMarker({lat:o.lat,lon:o.lng,icon:_},function(e){S[t]=e}),o.clickable&&S[t].addListener("click",function(e){return function(){var t=n.getDispEmplByApikey(e);if(t){var i=new google.maps.InfoWindow({content:'<img style="vertical-align:middle;margin-right:5px" width="42" height="42" src="'+t.pic+'"><b>'+t.firstName+"</b>"});T[e]=i,i.open(a.map,S[e])}}}(t)),A.push(t)),E[o.zone_id]?E[o.zone_id].indexOf(t)<0&&E[o.zone_id].push(t):E[o.zone_id]=[t])},r.removefromZone=function(e,t,n){for(var i in E){var o=E[i].indexOf(e);E[i].indexOf(e)>-1&&t&&(0==t.booked||t.zone_id!=i||n)&&E[i].splice(o,1)}},a.setMapMarkers=function(t){for(var n in t){var i={};if(i[n]=t[n],t[n].booked&&r.setMarkers(n,t[n]),S[n]){if(0==t[n].booked){google.maps.event.clearListeners(S[n],"click"),delete T[n],e.removeShape(S[n]),delete S[n];var o=A.indexOf(n);o>-1&&A.splice(o,1)}r.removefromZone(n,t[n])}}for(var n in S)if(!t[n]){google.maps.event.clearListeners(S[n],"click"),delete T[n],e.removeShape(S[n]),delete S[n];var o=A.indexOf(n);o>-1&&A.splice(o,1),r.removefromZone(n,t[n],!0)}r.setCircleColors()},a.setPolygons=function(t){for(var n=0,i=t.length;i>n;n++)if("polygon"==t[n].type.toLowerCase()){var o=[],a=t[n];a.lat.forEach(function(e){o.push({lat:Number(e)})}),a.lon.forEach(function(e,t){o[t].lng=Number(e)});var l=E[a.id]&&E[a.id].length>0;O[a.id]?e.updatePolygon(O[a.id],{path:o,strokeOpacity:.8,strokeColor:l?"#4cd964":"#FF0000",fillColor:l?"#4cd964":"#FF0000",fillOpacity:.15}):V.indexOf(a.id)<0&&(e.addPolygon({path:o,strokeColor:l?"#4cd964":"#FF0000",strokeOpacity:.8,strokeWidth:2,strokeWeight:2,fillColor:l?"#4cd964":"#FF0000",fillOpacity:.15},function(e){O[a.id]=e,r.setPolygonColors()}),V.push(a.id))}},a.setCircles=function(t){a.map&&(t.forEach(function(t){if(t.radius){E[t.id]||(E[t.id]=[]);var n={lat:Number(t.lat),lng:Number(t.lon)},i=1609*Number(t.radius),o=1609*Number(t.zone_radius),a=E[t.id]&&E[t.id].length>0;if(I[t.id]?e.updateCircle(I[t.id],{center:n,radius:i,strokeColor:a?"#4cd964":"#FF0000",fillColor:a?"#4cd964":"#FF0000"}):P.indexOf(t.id)<0&&(e.addCircle({strokeColor:a?"#4cd964":"#FF0000",strokeOpacity:.8,strokeWidth:2,strokeWeight:2,fillColor:a?"#4cd964":"#FF0000",fillOpacity:.15,center:n,radius:i},function(e){I[t.id]=e,google.maps.event.addListener(I[t.id],"click",L)}),P.push(t.id)),i!=o)I[t.id+"inner"]?e.updateCircle(I[t.id+"inner"],{strokeOpacity:.8,fillOpacity:.15,visible:a,center:n,radius:o,strokeColor:a?"#4cd964":"#FF0000",fillColor:a?"#4cd964":"#FF0000"}):P.indexOf(t.id+"inner")<0&&(e.addCircle({strokeColor:"#4cd964",strokeOpacity:.8,strokeWidth:2,strokeWeight:2,fillColor:"#4cd964",fillOpacity:.05,visible:a,center:n,radius:o},function(e){I[t.id+"inner"]=e,google.maps.event.addListener(I[t.id+"inner"],"click",L),r.setCircleColors()}),P.push(t.id+"inner"));else if(I[t.id+"inner"]){google.maps.event.clearListeners(I[t.id+"inner"],"click"),e.removeShape(I[t.id+"inner"]),delete I[t.id+"inner"];var l=P.indexOf(t.id+"inner");l>-1&&P.splice(l,1)}}}),a.setPolygons(t),r.setCircleColors())},r.setCircleColors=function(){for(var t in I)E[t]&&E[t].length>0?(e.updateCircle(I[t],{fillOpacity:.15,strokeColor:"#4cd964",fillColor:"#4cd964"}),I[t+"inner"]&&e.updateCircle(I[t+"inner"],{fillOpacity:.15,visible:!0,strokeColor:"#4cd964",fillColor:"#4cd964"})):E[t]&&0==E[t].length&&(I[t]&&e.updateCircle(I[t],{fillOpacity:.15,strokeColor:"#FF0000",fillColor:"#FF0000"}),I[t+"inner"]&&e.updateCircle(I[t+"inner"],{visible:!1}));r.setPolygonColors()},r.setPolygonColors=function(){for(var t in O)E[t]&&E[t].length>0?e.updatePolygon(O[t],{strokeColor:"#4cd964",strokeOpacity:.8,fillColor:"#4cd964",fillOpacity:.15}):E[t]&&0==E[t].length&&e.updatePolygon(O[t],{strokeColor:"#FF0000",strokeOpacity:.8,fillColor:"#FF0000",fillOpacity:.15})};var Y=function(){o(function(){N()})},q=!1;x=function(){google.maps.event.addListenerOnce(a.map,"idle",function(){q=!0,z()})},$(document).ready(function(){document.addEventListener("visibilitychange",function(){a.setMap()})}),a.centerMap=function(t,n,i){if(a.map)if(ionic.Platform.isWebView())e.centerMap(t,n,i);else{a.mapCentered=!0;var o=t||a.lat,r=n||a.lon,l=new google.maps.LatLng(o,r);a.map.panTo(l),a.map.setZoom(i||u.zoom)}},a.setMap=function(){ionic.Platform.isWebView()||window.google&&(a.map?z():null!=a.lat?Y():t.ready(function(){n.setLatLon().then(function(){Y()})}))},a.setMap();var j;a.setMapClass=function(e){a.map?(a.mapclass=null,a.mapclass=e,a.mapCentered=!0,document.querySelector("#gmap").className=e,a.setMap(),a.mapclass&&(document.querySelector("ion-view.pane").style.position="static",z()),o(function(){a.mapclass&&(document.querySelector("ion-view.pane").style.position="static")},500)):j=e},a.hasCircles=function(){return Object.keys(I).length>0},w=function(){for(var t in I){google.maps.event.clearListeners(I[t],"click"),google.maps.event.clearInstanceListeners(I[t]),e.removeShape(I[t]),delete I[t];var n=P.indexOf(t);n>-1&&P.splice(n,1)}for(var i in O){e.removeShape(O[i]),delete O[i];var n=V.indexOf(i);n>-1&&V.splice(n,1)}for(var o in S)google.maps.event.clearListeners(S[o],"click"),google.maps.event.clearInstanceListeners(S[o]),e.removeShape(S[o]),delete S[o];I=null,I={},O={},S=null,S={},E=null,E={},a.markers=null,A.length=P.length=V.length=0,F.forEach(function(t){e.removeDirections(t)}),F.length=0},a.resetMap=function(){a.map&&(w(),e.resetMap(),a.$broadcast("setmapclick",!1)),a.mapclass=null,document.querySelector("#gmap").className="",q=!1,D&&D.setMap(null)},r.$on("$destroy",function(){g&&($(window).off("resize",resizer),g.setOptions(u)),h&&h(),v&&v(),y&&y(),y&&C(),w()})}}}]).directive("validPasswordC",function(){return{require:"ngModel",link:function(e,t,n,i){i.$parsers.unshift(function(t,n){var o=t!=e.myForm.password.$viewValue;i.$setValidity("noMatch",!o)})}}}).directive("seats",["$ionicModal","$rootScope","$timeout","$ionicScrollDelegate","EmployeeService",function(e,t,n,i,o){return{restrict:"E",require:"?ngModel",replace:!0,template:'<div><i ng-if="isIcon != \'false\'" class="col button button-icon icon ion-person-add" ng-click="openSeatsModal()"></i><div ng-if="isIcon == \'false\'" class="ion-person-add" ng-form ng-click="openSeatsModal()"><input disabled type="text" ng-model="ngModel"></div></div>',scope:{items:"=",people:"=",splitfare:"=",alertsplitfare:"=",text:"=?",value:"=?",item:"=?",itemsArr:"=?",itemType:"=",callback:"&",doneCallback:"&",ngModel:"=?",show:"=?"},link:function(n,o,r,a){n.isIcon=r.isIcon||"",n.openSeatsModal=function(){t.$broadcast("setmapclick",!1),n.seatsModal?(n.seatsModal.show(),d()):e.fromTemplateUrl("modals/seats.html",{scope:n}).then(function(e){n.seatsModal=e,e.show(),d()})},n.$on("modal.hidden",function(){t.$broadcast("setmapclick",!0)}),n.seatsModel={setFunc:function(e){return e&&n.seats.forEach(function(t,n){t.checked=n==e-1}),angular.isDefined(e)?n.people=e:n.people}},n.splitEmails=[];var l=[];n.$on("$destroy",function(){n.seatsModal&&n.seatsModal.remove(),n.seatsModal=null,o.remove(),c&&c(),s&&s()}),n.seats=[{id:1,text:"1",checked:!0,icon:null},{id:2,text:"2",checked:!1,icon:null},{id:3,text:"3",checked:!1,icon:null},{id:4,text:"4",checked:!1,icon:null},{id:5,text:"5",checked:!1,icon:null}],n.shareFare={isChecked:!1};var s,c,d=function(){s=n.$watch("splitEmails.length",function(e,t,n){0==e&&(n.shareFare.isChecked=!1)}),c=n.$watch("shareFare.isChecked",function(e,n,i){e?e&&(t.disableSeatsCheck=i.splitEmails.every(function(e){return!e.valid})):t.disableSeatsCheck=!1})};n.addFare=function(e){n.splitEmails.push({id:n.splitEmails.length,email:"",valid:!0})},n.removeFare=function(e){var o=n.splitEmails.indexOf(e);o>-1&&n.splitEmails.splice(o,1),0==n.splitEmails.length?t.disableSeatsCheck=!1:t.disableSeatsCheck=n.splitEmails.every(function(e){return!e.valid}),i.scrollBy(0,-54,!0)},n.shareFareTapped=function(){0==n.splitEmails.length&&(n.splitEmails=[{id:0,email:"",valid:!0}]),i.resize(),n.shareFare.isChecked?i.scrollBottom(!0):i.scrollTop(!0)},t.disableSeatsCheck=!1,n.setValidEmail=function(e,i){n.splitEmails.forEach(function(t){t.id==e&&(t.valid=i)}),n.splitEmails.length>0&&(t.disableSeatsCheck=!i)},n.saveSeats=function(){l=[],n.splitEmails.length>0&&n.splitEmails.forEach(function(e){n.splitfare.push("splitFare[]="+e.email),l.push(e.email)}),n.seatsModal.hide(),n.alertsplitfare=l.join(",")}}}}]).directive("seatsButton",function(){return function(e,t,n){t.button(),e.$watch(n.seatsButtonDisabled,function(e){t.button("option","disabled",e)})}}).directive("splitFare",["$ionicScrollDelegate","baseUrl",function(e,t){return{restrict:"E",templateUrl:"modals/splitfare.html",scope:{index:"=",total:"=",notifyAdd:"&add",notifyRemove:"&remove",notifyValid:"&valid",ngModel:"="},controller:["$scope",function(n){n.baseUrl=t,n.showAddBtn=!1,n.emailInValid=!1,n.emailResult=function(e){n.emailInValid=!e},n.emailErrResult=function(e){n.emailError=!e,n.showAddBtn=e,n.notifyValid({isValid:e})},n.removeEmailField=function(){n.notifyRemove()},n.addEmailField=function(){n.notifyAdd(),e.resize(),e.scrollBottom(!0)},n.validating=function(e){n.isValidating=e}}]}}]).directive("customFooter",["$rootScope","$timeout","EmployeeService",function(e,t,n){return{restrict:"E",replace:!0,template:['<ion-footer-bar class="bar auto-height footer-container">','<div class="row driver-info">','<div class="dispatcherFtrRating col col-10">','<div style="margin: 15px 0;" ng-if="$root.loggedIn && $root.myCustomerRating && $root.show_rating" ng-click="$root.updateRating()">','<span ng-if="history.currentStateName() != \'app.quoteform\'" class="rating-number">{{$root.myDriverRating}}</span>','<span ng-if="history.currentStateName() == \'app.quoteform\'" class="rating-number">{{$root.myCustomerRating}}</span>','<div class="button-icon icon ion-star energized rating"></div>',"</div>","</div>","</div>","</ion-footer-bar>","</div>"].join(""),scope:{},link:function(t,i,o){t.history=e.history,t.vehicle=n.getVehiclePermit().vehicle,t.permit=n.getVehiclePermit().permit}}}]).directive("progressbar",["$rootScope","$timeout","$compile",function(e,t,n){return{restrict:"E",require:"?ngModel",replace:!0,template:"",scope:{callback:"&",max:"="},link:function(e,i,o){var r=i.find("timer")[0];e.countdown=e.$eval(o.countdown),e.max=e.$eval(o.max),e.callback=o.callback,e.defaultbgcolor=o.defaultbgcolor||"progress-defaultbgcolor",e.redbgcolor=o.redbgcolor||"progress-redbgcolor";var a='<div class="progress-wrapper"><div class=""><timer style="display:none" interval="1000" countdown=countdown finish-callback="countEnded()">{{mminutes}}:{{sseconds}}</timer></div><tek-progress-bar class="{{getColor()}}" bar-class="progress-bar-primary" ng-model="progressVal" manager="progressManager"></tek-progress-bar></div>';i.append(n(a)(e));var r=i.find("timer")[0];e.isRed=!1,e.getColor=function(){return e.isRed?e.redbgcolor:e.defaultbgcolor},e.countEnded=function(){e.callback=e.$eval(o.callback),"function"==typeof e.callback&&e.callback()},e.progressVal=0,e.checkRed=function(t){5>=t&&(e.isRed=!0)},e.checkRed(e.max-e.current);var l=e.$on("timer-tick",function(n,i){t(function(){e.checkRed(i.millis/1e3),e.current=e.max-i.millis/1e3,e.progressVal=Math.floor(e.current/e.max*100),e.timerText=r.outerText})});e.$on("$destroy",function(){l()})}}}]).directive("detectGestures",["$ionicGesture",function(e){return{restrict:"A",link:function(t,n,i){var o=e.on("tap",t.reportEvent,n),r=e.on("touch",t.onTouchEvent,n),a=e.on("swiperight",t.swipeRightEvent,n),l=e.on("swipeleft",t.swipeLeftEvent,n);t.$on("$destroy",function(){e.off(o,"tap",t.reportEvent),e.off(r,"touch",t.onTouchEvent),e.off(a,"swiperight",t.swipeRightEvent),e.off(l,"swipeleft",t.swipeLeftEvent)})}}}]).directive("ionSelect",function(){"use strict";return{restrict:"EAC",scope:{label:"@",labelField:"@",provider:"=",ngModel:"=?",ngValue:"=?"},require:"?ngModel",transclude:!1,replace:!1,template:'<div class="selectContainer"><label class="item item-input item-stacked-label"><div class="item item-input-inset" style="border:none"><label class=""><i class="icon"></i><input style="background-color:transparent" readonly id="filtro" ng-click="open()" placeholder="{{label}}" type="input" ng-model="ngModel" ng-value="ngValue" ng-keydown="onKeyDown()"/></label></div></label><div class="optionList padding-left padding-right" ng-show="showHide"><ion-scroll><ul class="list"><li class="item" ng-click="selecionar(item)" ng-repeat="item in provider | filter:ngModel">{{item[labelField]}}</li></ul></ion-scroll></div></div>',link:function(e,t,n,i){e.ngValue=void 0!==e.ngValue?e.ngValue:"item",e.selecionar=function(t){i.$setViewValue(t),e.showHide=!1},t.bind("click",function(){}),e.open=function(){return e.ngModel="",e.showHide=!e.showHide},e.onKeyDown=function(){e.showHide=!0,e.ngModel||(e.showHide=!1)},e.$watch("ngModel",function(n){n&&t.find("input").val(n[e.labelField])})}}}).directive("contact",["$ionicPopover",function(e){"use strict";return{restrict:"EA",scope:{contactNumber:"@",cls:"@"},replace:!0,template:'<div ng-class="cls" ng-click="showPopover($event)" style="display:inline-block">{{contactNumber}}</div>',link:function(t,n,i){e.fromTemplateUrl("popovers/call-sms.html",{scope:t}).then(function(e){t.popover=e}),t.showPopover=function(e){t.popover.show(e)},t.$on("$destroy",function(){t.popover&&(t.popover.remove(),t.popover=null)})}}}]).directive("share",["$ionicPopover","$compile","$cordovaSocialSharing","$ionicPlatform","$translate",function(e,t,n,i,o){"use strict";return{restrict:"A",link:function(t,r,a){o("SHARE_WITH_FRIENDS").then(function(e){t.text=t.$eval(a.share)&&t.$eval(a.share).text||e}),t.subject="",r.addClass("shareicon"),r.on("click",function(i){ionic.Platform.isWebView()?n.share(t.text,t.subject,null,null).then(function(e){},function(e){}):t.popover?t.popover.show(i):e.fromTemplateUrl("popovers/share.html",{scope:t}).then(function(e){t.popover=e,t.popover.show(i)})}),t.canShareEmail=!1,ionic.Platform.isWebView()&&i.ready(function(){n.canShareViaEmail().then(function(e){t.canShareEmail=!0})});var l=function(e){var n=[];return n=[t.text]};t.sharemethod=function(e){alert(e),n["shareVia"+e].apply(this,l(e)).then(function(e){},function(e){})},t.$on("$destroy",function(){t.popover&&(t.popover.remove(),t.popover=null)})}}}]).directive("fancySelect",["$ionicModal","$rootScope","$timeout","EmployeeService","$filter",function(e,t,n,i,o){return{restrict:"E",templateUrl:"fancyselect/fancy-select.html",scope:{items:"=",text:"=?",value:"=?",item:"=?",itemsArr:"=?",itemsDetail:"=?",itemType:"=",callback:"&",doneCallback:"&",selectCallback:"&",show:"=?"},link:function(i,r,a){i.multiSelect="true"===a.multiSelect?!0:!1,i.allowEmpty="false"===a.allowEmpty?!1:!0,n(function(){i.heading=void 0!==a.heading?a.heading:!1,i.emptyText=void 0!==a.emptyText?a.emptyText:!1,i.headerText=a.headerText||""}),i.defaultText=i.text||"",i.noteText=a.noteText||"",i.noteImg=a.noteImg||"",i.noteImgClass=a.noteImgClass||"",i.noteImgWidth=a.noteImgWidth||"",i.noteImgHeight=a.noteImgHeight||"",i.onlyIcon=a.onlyIcon||"",i.icon=a.icon||"";var l=a.$observe("noteImg",function(e){""!=e&&(i.noteImg=a.noteImg,i.noteImgClass=a.noteImgClass,i.noteImgWidth=a.noteImgWidth,i.noteImgHeight=a.noteImgHeight,l())});e.fromTemplateUrl("fancyselect/fancy-select-items.html",{scope:i}).then(function(e){i.modal=e}),i.numDrivers=function(e){return Object.keys(i.itemsDetail[e]).length},i.validate=function(e){1==i.multiSelect&&(i.value="",i.text="",jQuery.each(i.itemss,function(e,t){t.checked&&(i.value=i.value+t.id+";",i.text=i.text+t.text+", ")}),i.value=i.value.substr(0,i.value.length-1),i.text=i.text.substr(0,i.text.length-2)),("undefined"==typeof i.value||""==i.value||null==i.value)&&(0==i.allowEmpty?(i.value=i.itemss[0].id,i.text=i.itemss[0].text,i.itemss[0].checked=!0):i.text=i.defaultText),i.items=i.itemss,i.itemsArr=i.itemsArray,i.itemType=i.itemTypes,i.item=i.itemm,i.hideItems()};var s=function(){i.showbtn=o("checkedItem")(i.itemss,"checked",null)};i.modalshown=!1,i.showbtn=!1,i.showItems=function(e){i.itemss=angular.copy(i.items),i.itemsArr&&(i.itemsArray=angular.copy(i.itemsArr)),i.itemType&&(i.itemTypes=i.itemType),i.item&&(i.itemm=i.item),e.preventDefault(),i.modal.show(),t.$broadcast("setmapclick",!1),i.modalshown=!0,void 0==i.itemsArr&&void 0==a.itemsArr&&(i.itemsArray=[],1==i.itemss.length?i.itemSelected(i.itemss[0].text):i.itemsArray=i.itemss.filter(function(e){return e.checked})),void 0==i.itemType&&(i.itemTypes=""),1==i.multiSelect&&i.setItemCheckMark(!0)},t.showFancy=function(e){i.showItems(e)},i.show=function(e){i.showItems(e)},i.hideItems=function(){"function"==typeof i.callback&&n(function(){i.callback({selVal:i.value})}),i.modal.hide()},i.$on("$destroy",function(){i.modal&&i.modal.remove(),i.modal=null,r.remove(),c(),d()}),i.$on("$destroyfancy",function(){i.modal&&i.modal.remove()}),i.$on("modal.hidden",function(){d(),t.$broadcast("setmapclick",!0)});var c=i.$on("hide:fancy",function(){i.modal.hide()});i.$on("resetfancy",function(){i.items.forEach(function(e){e.checked=!1}),i.itemsArray&&(i.itemsArray.length=0)});var d=i.$watch("items",function(e,t){if(void 0!=e&&void 0!=t){i.itemss=i.items;var n={};e.forEach(function(e){n[e.id]=e});var o=t.filter(function(e){return!(e.id in n)});if(i.itemsArr&&i.itemsArray)for(var r in o){var a=i.itemsArray.indexOf(o[r].text);a>-1&&i.itemsArray.splice(a,1)}}});i.validateSingle=function(e){i.text=e.text,i.value=e.id,i.noteImg=e.icon,i.itemSelected(i.value),"function"==typeof i.callback,s(),i.validate()},i.validateMultiple=function(e){e.hasOwnProperty("disabled")&&e.disabled||(i.text=e.text,i.value=e.id,i.noteImg=e.icon,i.itemSelected(i.value),"function"==typeof i.callback,"function"==typeof i.selectCallback&&i.selectCallback({selVal:e}),s())},i.itemSelected=function(e){if(""==e)return i.itemsArray=[],i.itemm="",void(i.itemTypes="");if(i.itemsArray.indexOf(e)>-1){if(1==i.itemsArray.length)return i.setItemCheckMark(!1),e.split(",").length>1&&i.itemsArray.splice(i.itemsArray.indexOf(e),1),i.itemsArray=[],i.itemm="",void(i.itemTypes="");i.itemsArray.splice(i.itemsArray.indexOf(e),1)}else i.multiSelect||(i.setItemCheckMark(!1),i.itemsArray.length=0),e.indexOf(";")<0&&i.itemsArray.push(e);1==i.itemsArray.length?i.itemTypes=i.itemm=i.itemsArray[0]:(i.itemm=i.itemsArray.join(", "),i.itemTypes=i.itemsArray.join(",")),i.setItemCheckMark(!0)},i.setItemCheckMark=function(e){i.itemsArray;i.itemss.forEach(function(t){i.itemsArray.indexOf(t.id)>-1?t.checked=e?!0:!t.checked:t.checked=!1})}}}}]).directive("datePicker",["$ionicModal","$rootScope","$timeout","EmployeeService",function(e,t,n,i){return{restrict:"E",require:"?ngModel",templateUrl:"datepicker/fancy-select.html",scope:{callback:"&",doneCallback:"&",render:"&?",show:"=?",name:"=?",ngModel:"=?",tz:"=?"},link:function(i,o,r,a){n(function(){i.heading=void 0!==r.heading?r.heading:!1}),i.config=void 0!==r.config?r.config:{},i.required=void 0!==r.required?r.required:!1,i.headerText=r.headerText||"",i.name=r.name||void 0,i.isIcon=r.isIcon||"",i.tz=i.tz||t.tz,i.newUser={},i.tmp={},i.tmp.newDate=i.newUser.trackerDate,null!=a&&(a.$render=function(){void 0!=a.$modelValue?i.tmp.newDate=new Date(a.$modelValue):void 0!=i.newDate&&(i.tmp.newDate=new Date(i.newDate)),void 0==i.tmp.newDate&&(r.hasOwnProperty("renderafter")&&(i.tmp.newDate=""==r.renderafter?new Date:moment(r.renderafter,"MM-DD-YYYY").toDate()),r.hasOwnProperty("renderbefore")&&(i.tmp.newDate=""==r.renderbefore?new Date:moment(r.renderbefore,"MM-DD-YYYY").toDate()),r.hasOwnProperty("defaultexpiry")&&(i.tmp.newDate=new Date("12/31/"+(new Date).getFullYear())))}),i.beforeRender=function(e,t,n,o,a){if(r.hasOwnProperty("renderafter")||r.hasOwnProperty("renderbefore")){var l,s,c,d,u,m,p,f,g,h,v,y;r.hasOwnProperty("renderafter")&&(l=""==r.renderafter?new Date:moment(r.renderafter,"MM-DD-YYYY").toDate()),r.hasOwnProperty("renderbefore")&&(l=""==r.renderbefore?new Date:moment(r.renderbefore,"MM-DD-YYYY").toDate()),r.hasOwnProperty("reservation")&&(l=moment(l).add(i.$eval(r.reservation),"minutes").toDate()),r.hasOwnProperty("remoteReservation")&&(s=moment(new Date).add(i.$eval(r.remoteReservation),"minutes").toDate(),i.tz&&(s=moment(moment(s).tz(i.tz).format("YYYY-MM-DD HH:mm:ss")).toDate())),i.tz&&(l=moment(moment(l).tz(i.tz).format("YYYY-MM-DD HH:mm:ss")).toDate());var w=l.getFullYear(),k=l.getMonth(),b=moment(l).date(),$=l.getHours(),C=l.getMinutes(),x=6e4*l.getTimezoneOffset(),M=new Date(w,0,1).getTime(),D=new Date(w,k,1).getTime(),S=new Date(w,k,b).getTime(),T=new Date(w,k,b,$).getTime(),E=new Date(w,k,b,$,C).getTime();r.hasOwnProperty("remoteReservation")&&(c=s.getFullYear(),d=s.getMonth(),u=moment(s).date(),m=s.getHours(),p=s.getMinutes(),f=new Date(c,0,1).getTime(),g=new Date(c,d,1).getTime(),h=new Date(c,d,u).getTime(),v=new Date(c,d,u,m).getTime(),y=new Date(c,d,u,m,p).getTime());var I=!0;n.dateValue+x;"day"==e&&(o.display=o.display.split("-").reverse().join(", ")),t.forEach(function(n,i){var o=t[i].dateValue+x;"year"==e?(I=r.hasOwnProperty("renderafter")?o>=M:M>=o,I=r.hasOwnProperty("remoteReservation")?I&&f>=o:I):"month"==e?(I=r.hasOwnProperty("renderafter")?o>=D:D>=o,I=r.hasOwnProperty("remoteReservation")?I&&g>=o:I):"day"==e?(I=r.hasOwnProperty("renderafter")?o>=S:S>=o,I=r.hasOwnProperty("remoteReservation")?I&&h>=o:I):"hour"==e?(I=r.hasOwnProperty("renderafter")?o>=T:T>=o,I=r.hasOwnProperty("remoteReservation")?I&&v>=o:I):"minute"==e&&(I=r.hasOwnProperty("renderafter")?o>=E:E>=o,I=r.hasOwnProperty("remoteReservation")?I&&y>o:I),t[i].selectable=I})}},i.modalshown=!1;var l=function(){i.modal.show(),i.modalshown=!0,t.$broadcast("setmapclick",!1),ionic.Platform.isWebView()&&cordova.plugins.Keyboard.isVisible&&cordova.plugins.Keyboard.hide(),void 0!=i.newDate&&(i.newDate=void 0),angular.element(document.querySelector(".datetimepicker")).controller("ngModel").$render(i.tz),$(".modal-backdrop:has(.dtmodal)").css("z-index",30)};e.fromTemplateUrl("datepicker/fancy-select-items.html",{scope:i}).then(function(e){i.modal=e}),i.showDatepicker=function(e){e.preventDefault(),l()},i.hideDatePicker=function(){i.modal.hide(),t.$broadcast("setmapclick",!0)},i.$on("$destroy",function(){i.modal&&i.modal.remove(),i.modal=null,o.remove(),c(),s()}),i.$on("$destroyfancy",function(){i.modal&&i.modal.remove()}),i.$on("modal.hidden",function(){});var s=i.$on("resetDtPicker",function(e,t){document.querySelector(".datetimepicker")&&(i.tmp.newDate=void 0)}),c=i.$on("hide:datepicker",function(){i.hideDatePicker()});i.onTimeSet=function(e,t){i.oldDate=t,i.newDate=e,void 0==t&&(i.oldDate=i.newDate)},i.save=function(){i.hideDatePicker(),"function"==typeof i.callback&&i.tmp.newDate&&i.callback({selDate:i.tmp.newDate,field:i.name})}}}}]).directive("mooFocusExpression",["$timeout",function(e){return{restrict:"A",link:{post:function(t,n,i){t.$watch(i.mooFocusExpression,function(o){i.mooFocusExpression&&t.$eval(i.mooFocusExpression)&&e(function(){n[0].focus()},100)})}}}}]).directive("accordion",["$rootScope","$timeout",function(e,t){return{restrict:"E",transclude:!0,scope:{items:"=",obj:"=",open:"=?",shown:"=",outershown:"=?"},template:'<ion-scroll ng-class="outershown ? scrollcls : \'\'" direction="y"><ion-list class="list-inset {{cls}}"><ion-item class="accordionClickItem" style="padding:0" ng-click="toggleInfo(obj)" ng-class="{active: isInfoShown(obj)}"><button ng-click="showActions(obj)" class="button button-clear button-dark accordion-heading">{{obj.heading}}</button><button style="float:right;" class="button button-clear button-positive" ng-class="isInfoShown(obj) ? \'ion-chevron-up\' : \'ion-chevron-down\'"></button></ion-item><ion-item class="item-accordion item-content item-text-wrap" ng-show="isInfoShown(obj)" ng-repeat="item in items" transcope></ion-item></ion-list></ion-scroll>',link:function(e,n,i){"noscroll"in i&&$(n).find("ion-list").unwrap().unwrap(),e.scrollcls=i.scrollcls||"";var o=i.$observe("scrollcls",function(t){e.scrollcls=t||""}),r=e.$watch(i.obj,function(t){void 0!=t&&(e.obj=t)});e.tapped=function(t){"A"!=t.target.tagName&&e.$emit("accorditemtapped",t)},e.cls=i.cls,e.toggleInfo=function(t){e.isInfoShown(t)?e.shownInfo=null:e.shownInfo=t},e.open=function(){var e=n[0].querySelector(".accordionClickItem");t(function(){angular.element(e).trigger("click")})},e.isInfoShown=function(t){return e.shown=t&&e.shownInfo===t,t&&e.shownInfo===t},e.$on("$destroy",function(){r(),o()})}}}]).directive("transcope",function(){return{link:function(e,t,n,i,o){if(!o)throw minErr("ngTransclude")("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",startingTag(t));var r=e.$new();o(r,function(e){t.empty(),t.append(e),t.on("$destroy",function(){r.$destroy()})})}}}).directive("bindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,i){t.$watch(function(){return t.$eval(i.bindHtmlCompile)},function(i){n.html(i),e(n.contents())(t)})}}}]).directive("backbutton",[function(){return{restrict:"E",replace:!0,scope:!1,template:'<button class="button icon button-clear"></button>',compile:function(e,t){var n=ionic.Platform.isAndroid()?"ion-android-arrow-back":"ion-ios-arrow-back";angular.element(e[0]).addClass(n)}}}]).directive("fixedbtn",["$ionicGesture","$rootScope","$timeout",function(e,t,n){
return{restrict:"C",link:function(e,t,n){}}}]).directive("btnfunc",["$ionicGesture","$ionicScrollDelegate","$timeout","$rootScope",function(e,t,n,i){return{restrict:"A",scope:{func:"&btnfunc"},link:function(i,o,r){var a=function(){n(function(){i.func()}),n(function(){var e=$(o).parents().has(angular.element("form")).first(),n=$(e).find("form")[0];if(n&&$(n.querySelector(".ng-invalid"))[0]){var i=$(n.querySelector(".ng-invalid")).offset().top-84;t.scrollBy(0,i,!0)}})};n(function(){var e=$(o).closest("ion-view, .modal"),n=e.find("ion-content"),i=e.find("form");if(i){var r=1==i.children().length&&i.children().children()||i.children();r.not(':has([ng-click^="show"][ng-click$="()"])'),r.length>0&&r.on("click","> *",function(e){var i=(ionic.DomUtil.getParentWithClass(e.target,"scroll-content"),$(window).height()-n.offset().top-n.height()),o=$(window).height()-$(e.target).offset().top-$(e.target).height();30>o-i&&setTimeout(function(){t.scrollBy(0,100,!0)},400)})}});var l=e.on("swipe",a,o);i.$on("$destroy",function(){e.off(l,"swipe",a)})}}}]).directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,n,i){i.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){i.$validate()})}}}).directive("checkRequired",function(){return{require:"ngModel",restrict:"A",link:function(e,t,n,i){i.$validators.checkRequired=function(t,i){var o=t||i,r=e.$eval(n.ngTrueValue)||!0;return o&&r===o}}}}).directive("ionToggleCustomText",function(){var e=angular.element;return{restrict:"A",require:"ngModel",link:function(t,n,i,o){var r=i.ngTrueText||"on",a=i.ngFalseText||"off";if(i.ionToggleCustomText){var l=i.ionToggleCustomText.split(";");2===l.length&&(r=l[0]||r,a=l[1]||a)}var s=e('<div class="handle-text-custom handle-text-custom-true">'+r+"</div>"),c=e('<div class="handle-text-custom handle-text-custom-false">'+a+"</div>"),d=n.find("label");if(d.length){d.addClass("toggle-text-custom");var u,m,p=d.find("div");if(angular.forEach(p,function(t){var n=e(t);n.hasClass("handle")?m=n:n.hasClass("track")&&(u=n)}),m&&u){m.append(s),m.append(c);var f=s[0].offsetWidth,g=c[0].offsetWidth;s.css("left","-"+(f+6)+"px"),t.$watch(function(){return o.$modelValue},function(e){e==i.ngTrueValue.replace(/\'/g,"")?m.css("left",f+12+9+"px"):m.css("left","6px")});var h=Math.max(f,g);u.css("width",h+43+"px")}}}}}).directive("ionToggleText",["$compile","$rootScope",function(e,t){var n=angular.element;return{restrict:"A",scope:{},link:function(e,i,o){var r=o.ngOnValue||"on",a=o.ngOffValue||"",l=o.$observe("ngOnValue",function(t){r=t,e.build()}),s=o.$observe("ngWithinZone",function(t){e.toggleClass(e.$eval(t))}),c=o.$observe("booked",function(t){e.build(),o.ngWithinZone||e.toggleClass(e.$eval(t))});e.$destroy=function(){l(),s(),c()},e.toggleClass=function(e){var t=i.find("label");e?t.removeClass("toggle-outsidezone").addClass("toggle-withinzone"):t.removeClass("toggle-withinzone").addClass("toggle-outsidezone")},e.build=function(){if(o.ionToggleText){var e=o.ionToggleText.split(";");2===e.length&&(r=e[0]||r,a=e[1]||a)}var l=n('<div class="handle-text handle-text-true">'+r+"</div>"),s=n('<div class="handle-text handle-text-false">'+a+"</div>"),c=i.find("label");if(c.length){c.addClass("toggle-text");var d,u,m=c.find("div");if(angular.forEach(m,function(e){var t=n(e);t.hasClass("handle")?u=t:t.hasClass("track")&&(d=t)}),u&&d){i[0].querySelector(".handle-text")&&(u.html(""),u.html("")),u.append(l),u.append(s);var p=l[0].offsetWidth,f=s[0].offsetWidth;p=Math.max(p,26),f=Math.max(f,26);var g=l.textWidth()<29?-7:0;l.css("left","-"+(p+7+g)+"px"),s.css("left",f+14+"px");var h=Math.max(p,f);d.css("width",h+52+"px"),"true"==o.booked?(u.css("left",p+10+14+"px"),angular.element(i[0].querySelector(".handle-text-false")).css("color","transparent"),angular.element(i[0].querySelector(".handle-text-true")).css("color","white")):(u.css("left","7px"),angular.element(i[0].querySelector(".handle-text-true")).css("color","transparent"),angular.element(i[0].querySelector(".handle-text-false")).css("color","black"),d.css("width","77px")),o.booked&&o.driver&&!t.show_QP&&angular.element(i[0].querySelector(".handle-text-true")).css("display","none")}}},e.build()}}}]).directive("vin",["$q","$timeout","$http","$rootScope",function(e,t,n,i){return{restrict:"A",require:"ngModel",scope:{onDone:"&",onValidating:"="},link:function(t,i,o,r){r.$asyncValidators.vin=function(i){var o=e.defer();return t.onValidating=!0,n.get("https://api.edmunds.com/api/vehicle/v2/vins/"+i+"?fmt=json&api_key=9mjx9dzqsq8gzjcehjmcnyuq").then(function(e){t.onDone({res:e}),o.resolve()},function(e){t.onDone({res:e}),o.resolve()})["finally"](function(){t.onValidating=!1}),o.promise}}}}]).directive("clearField",["$compile",function(e){return{restrict:"A",scope:!0,require:"^form",template:"<ng-transclude></ng-transclude>",transclude:!0,link:function(t,n,i,o,r){var a=i.clrClass||"rt5",l=n.find("input"),s=l[0].attributes["ng-model"].value,c=(t.$parent.$new(),angular.element('<span ng-if="'+s+" !== '' && "+s+' != undefined" ng-click="clearSearch()" class="button button-clear ft25 ion-ios-close '+a+'"></span>'));c.insertAfter(n),e(c)(t),t.clearSearch=function(){var e=l[0].name;o[e].$setViewValue(""),angular.element(l).controller("ngModel").$render()}}}}]).directive("tooltip",["$translate",function(e){return{restrict:"C",link:function(t,n,i){e(["BUTTON_SWIPTE_TOOLTIP","FILL_FORM"]).then(function(e){var t=$(n);t.attr("title",i.title||e.BUTTON_SWIPTE_TOOLTIP);t.tooltipster({animation:i.animation||"fade",trigger:"click",position:"top",positionTracker:!0,maxWidth:500,timer:1e3,contentAsHTML:!0,functionInit:function(e,t){},functionBefore:function(n,i){t.hasClass("disabled")?(n.tooltipster("content",n.attr("disable-title")||e.FILL_FORM),i()):(n.tooltipster("content",n.attr("title")||e.BUTTON_SWIPTE_TOOLTIP),i())}})})}}}]).directive("ionSearch",function(){return{restrict:"E",replace:!0,scope:{getData:"&source",model:"=?",search:"=?filter"},link:function(e,t,n){n.minLength=n.minLength||0,e.placeholder=n.placeholder||"",e.search={value:""},n["class"]&&t.addClass(n["class"]),n.source&&e.$watch("search.value",function(t,i){t.length>n.minLength?e.getData({str:t}).then(function(t){e.model=t}):e.model=[]}),e.clearSearch=function(){e.search.value=""}},template:'<div class="item-input-wrapper"><i class="icon ion-android-search"></i><input type="search" placeholder="{{placeholder}}" ng-model="search.value"><i ng-if="search.value.length > 0" ng-click="clearSearch()" class="icon ion-close"></i></div>'}}).filter("checkedItem",function(){return function(e,t,n){var i=e.some(function(i,o){return(e.length-1!=o||"object"==typeof n)&&i[t]||n&&e.length-1==o&&i[t]});return i}}).filter("nl2br",["$filter",function(e){return function(e){return e?e.replace(/\n\r?/g,"<br />"):e}}]).filter("ftToMiles",function(){return function(e){return e&&e.indexOf("ft")>-1?parseFloat(189394e-9*parseInt(e,10)).toFixed(1)+" mi":e}});