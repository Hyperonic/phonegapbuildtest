angular.module("starter",["ionic","starter.controllers","directory.services","directory.directives","ngCordova","firebase","ion-google-place","ionic.rating","ngMessages","ui.bootstrap.datetimepicker","ui.map","ngStorage","remoteValidation","ngCookies","pascalprecht.translate","toastr","timer","ui.validate","ion-autocomplete","monospaced.elastic","ionicLazyLoad","ngSanitize","naif.base64","jett.ionic.filter.bar","angularMoment","templates","Tek.progressBar","tabSlideBox","oc.lazyLoad","ngCordovaOauth","satellizer","720kb.socialshare"]).run(["$cordovaLocalNotification","$interval","$localStorage","$ionicNavBarDelegate","Internet","$injector","$urlRouter","$cordovaSpinnerDialog","Initializer","$ionicSideMenuDelegate","$ionicHistory","$translate","$window","$cordovaGlobalization","$cordovaSplashscreen","$cordovaVibration","$timeout","GpsDetectService","ApiParamService","EmployeeService","$ionicPlatform","$rootScope","$state","AuthService","$ionicLoading","$cordovaNetwork","$cordovaGeolocation",function(e,t,o,n,a,i,r,l,s,c,p,u,d,m,h,f,g,v,w,y,C,b,O,L,I,S,P){b.platformReady=!1,g(function(){r.sync(),r.listen()}),$.fn.textWidth=function(){var e=$(this).html();$(this).html("<span>"+e+"</span>");var t=$(this).find("span:first").width();return $(this).html(e),t},b.history=p,b.customLoader=function(e,t){if(!(b.showingLoader&&!t||b.loadingMsg===e||b.isOffline)){b.showingLoader=!0;var o=["SENDING"];e&&("string"==typeof e?(b.loadingMsg=e,o.push(e)):(b.loadingMsg=e.slice(0),o=o.concat(e))),u(o).then(function(t){var n=e?t[e]:t.SENDING;if(e){var a=[];o.slice(1).forEach(function(e){a.push(t[e])});var n=a.join(" ")}else var n=t.SENDING;b.showingLoader=!0,ionic.Platform.isWebView()?(l.hide(),l.show("",n,!0)):I.show({noBackdrop:!0,template:'<p class="item-icon-left">'+n+"<ion-spinner /></p>"})})}},b.hideLoader=function(){b.showingLoader=!1,b.loadingMsg=null,ionic.Platform.isWebView()&&l.hide(),I.hide()},b.dontHideLoader=!1,b.isOffline=!1,b.isGpsOff=!1;var D,U=function(){return ionic.Platform.isWebView()?S.isOnline():navigator.onLine};C.ready(function(){b.isOffline=!U(),b.platformReady=!0,b.customLoader("WAIT"),window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault();var o;if(D=function(){a.IsConn().then(function(e){if(e){if(o){if(t.cancel(o),!b.isOffline)return;b.isOffline=!1,b.$broadcast("internet:online"),b.isGpsOff?u("GPS_OFF").then(function(e){I.show({template:e}),b.hideLoader()}):(b.hideLoader(),y.internetGPSReconnected())}}else u("OFFLINE").then(function(e){l.hide(),I.show({template:e})}),y.cancelOfferTimeout(),y.clearAutoBookInt(),b.$broadcast("internet:offline"),g(function(){b.isOffline=!0}),ionic.Platform.isWebView()&&f.vibrate(500),u("OFFLINE").then(function(e){I.show({template:e}),ionic.Platform.isWebView()&&l.hide()}),o=t(function(){U()?b.getIpAddress():t.cancel(o)},1e4)},function(e){y.cancelOfferTimeout(),y.clearAutoBookInt(),b.$broadcast("internet:offline"),g(function(){b.isOffline=!0}),ionic.Platform.isWebView()&&f.vibrate(500),u("OFFLINE").then(function(e){I.show({template:e}),ionic.Platform.isWebView()&&l.hide()}),o=t(function(){U()?b.getIpAddress():t.cancel(o)},1e4)})},ionic.Platform.isWebView()){var n=function(){e.schedule({id:1,at:moment().add(15,"seconds").toDate(),text:"A2B is not running",title:"A2B",icon:"icon"}).then(function(){})};n(),t(function(){e.cancelAll().then(function(e){n()})},1e4),h.hide(),ionic.Platform.isAndroid()&&cordova.plugins.locationAccuracy.request(function(){},function(e){e.code!==cordova.plugins.locationAccuracy.ERROR_USER_DISAGREED&&window.confirm("Failed to automatically set Location Mode to 'High Accuracy'. Would you like to switch to the Location Settings page and do this manually?")&&cordova.plugins.diagnostic.switchToLocationSettings()},cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY),C.registerBackButtonAction(function(e){e.preventDefault(),b.detail&&b.detail.isDriver&&"app.trip-detail"!=toState.name||navigator.app.backHistory()},101),window.addEventListener("native.keyboardshow",function(){b.keyboardopen=!0}),window.addEventListener("native.keyboardhide",function(){b.keyboardopen=!1}),document.addEventListener("offline",function(){y.cancelOfferTimeout(),y.clearAutoBookInt(),b.$broadcast("internet:offline"),g(function(){b.isOffline=!0}),ionic.Platform.isWebView()&&f.vibrate(500),u("OFFLINE").then(function(e){I.show({template:e}),ionic.Platform.isWebView()&&l.hide()})},!1),document.addEventListener("online",function(){b.isOffline&&(D(),b.isOffline=!1,b.$broadcast("internet:online"),b.isGpsOff?u("GPS_OFF").then(function(e){I.show({template:e}),b.hideLoader()}):(b.hideLoader(),y.internetGPSReconnected()))},!1),keepscreenon.enable(),cordova.plugins.backgroundMode.enable(),u(["APP_BACKGROUND_TITLE"]).then(function(e){cordova.plugins.backgroundMode.setDefaults({title:e.APP_BACKGROUND_TITLE,ticker:e.APP_BACKGROUND_TITLE,text:""})}),m.getPreferredLanguage().then(function(e){u.use(e.value.split("-")[0]).then(function(e){},function(e){})},function(e){}),document.addEventListener("resume",function(){b.$broadcast("onresume")},!1),document.addEventListener("pause",function(){b.$broadcast("onpause")},!1)}y.setLatLon(),s.mapsInitialized().then(function(){b.$broadcast("gmaps:loaded")}),y.autoBookIn(),y.networkListener(),b.$on("loading:show",function(e,t,o){b.isOffline||b.isGpsOff||!b.showLoader||t&&t.hasOwnProperty("show")&&!t.show||b.customLoader(t&&t.text,o)}),b.$on("loading:hide",function(e,t){b.showLoader=!0,b.isOffline||b.isGpsOff||b.startupLoading||b.appoverdue||!t&&(b.dontHideLoader||0!==i.get("$http").pendingRequests.length&&!i.get("$http").pendingRequests.every(function(e){return!e.data||e.data&&!e.data.show}))||b.hideLoader()}),b.showLoader=!0,D()}),b.getIpAddress=function(){$.ajax({url:"http://freegeoip.net/json/",type:"POST",dataType:"jsonp",success:function(e){b.mapAccess="45.55.73.110"==e.ip}})},b.noGroups=!1,y.authenticateFirebase(),ionic.Platform.isWebView()||(b.isOffline&&u("OFFLINE").then(function(e){I.show({template:e})}),d.addEventListener("offline",function(){y.cancelOfferTimeout(),y.clearAutoBookInt(),b.$broadcast("internet:offline"),b.$apply(function(){b.isOffline=!0,u("OFFLINE").then(function(e){I.show({template:e})})})},!1),d.addEventListener("online",function(){D(),b.$broadcast("internet:online"),b.isOffline=!1,b.isGpsOff?u("GPS_OFF").then(function(e){I.show({template:e})}):(b.hideLoader(),y.internetGPSReconnected())},!1)),null!=window.localStorage.getItem("lat"),null!=window.localStorage.getItem("countryCode")&&(b.countryCode=window.localStorage.getItem("countryCode"));var A=!1;b.$on("firebaseInitialized",function(){A=!1}),b.isNotCustomer=!0,b.$on("$stateChangeStart",function(e,t,o,n,a){if(b.showBookBtn=!0,b.onQuotePage=t.quotepage,"app.quoteform"!=t.name&&null!=document.querySelector(".ion-google-place-container")&&$(".ion-google-place-container").remove(),t.authenticate){if(!L.isAuthenticated())return b.noGroups?O.transitionTo("app.login"):O.transitionTo("app.quoteform"),void e.preventDefault();t.noCustomer&&!b.isNotCustomer&&e.preventDefault(),t.intrip&&!L.isInTrip()&&(O.transitionTo("app.employee-index"),e.preventDefault()),t.onlydispatcher&&L.isDispatcherAdmin(o,null,null,!0).then(function(t){t||(O.transitionTo("app.employee-index"),e.preventDefault())}),t.onlyadmin?L.isDispatcherAdmin(o,!0).then(function(t){t||(O.transitionTo("app.employee-index"),e.preventDefault())}):y.isInitializingFB()&&!A&&(A=!0,O.transitionTo("app.employee-index"),e.preventDefault()),t.hasmapaccess?b.isNotCustomer||(O.transitionTo("app.employee-index"),e.preventDefault()):t.onlyglobaldriver&&!b.globalDriver&&(O.transitionTo("app.employee-index"),e.preventDefault())}else(t.guest&&L.isAuthenticated()||"app.suspended"==t.name&&!b.app_suspended)&&(y.isDriver()?O.transitionTo("app.employee-index"):O.transitionTo("app.quoteform"),e.preventDefault());L.isAuthenticated()&&b.noGroups&&"app.add-group"!=t.name&&"app.employee-index"!=t.name&&e.preventDefault(),b.showFooter=!0}),moment.locale("en",{relativeTime:{future:"in %s",past:"%s ago",s:"%d sec",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"}})}]).config(["$authProvider","$provide","$ionicFilterBarConfigProvider","msdElasticConfig","$compileProvider","$ionicConfigProvider","$stateProvider","$urlRouterProvider","$httpProvider","$translateProvider","toastrConfig",function(e,t,o,n,a,i,r,l,s,c,p){var u={popupOptions:{location:"no",toolbar:"yes",width:window.screen.width,height:window.screen.height},responseType:"token"},d={},d={facebook:"705570759582781",google:"124877572507-8tllo02mjv7io5vdmmr86h64qliijj17.apps.googleusercontent.com",yahoo:"dj0yJmk9M2Fkb2FoQ1c0bm1jJmQ9WVdrOVVUaHROV05sTTJNbWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD02OQ--",instagram:"eab734484d7e480a943212d86794ad00"};ionic.Platform.isWebView()&&(d.facebook="1052030131517454",d.yahoo=""),ionic.Platform.isWebView()&&(e.cordova=!0,u.redirectUri="http://localhost/"),e.facebook(angular.extend({},u,{clientId:d.facebook})),e.yahoo(angular.extend({},u,{clientId:d.yahoo})),e.instagram({clientId:d.instagram}),e.google(angular.extend({},u,{clientId:d.google})),ionic.Platform.isAndroid()&&i.scrolling.jsScrolling(!0),a.imgSrcSanitizationWhitelist(/^\s*(https?|file|blob|cdvfile|content):|data:image\//),angular.extend(p,{timeOut:3e4,newestOnTop:!0,positionClass:"toast-top-full-width",preventOpenDuplicates:!0}),c.useStaticFilesLoader({prefix:"",suffix:".json"}),c.useSanitizeValueStrategy(null),c.useLocalStorage(),c.preferredLanguage("custom_locales/locale-en"),c.fallbackLanguage("locales/locale-en"),l.deferIntercept(),i.views.maxCache(0),i.form.toggle("large"),i.form.checkbox("circle"),i.templates.maxPrefetch(0),s.defaults.cache=!1;var m=3e4;t.decorator("$http",["$delegate",function(e){var t=e,o=[];return t.get=function(e,n){n=n||{timeout:m};var a=n.timeout?Date.now():"",i=e+JSON.stringify(n.params||{})+a;e.indexOf("a2bapp.com/api")>-1&&(e+="&_t="+Date.now());var r=_.find(o,{id:i});if(r)return r.promise;var l=t(angular.extend({skipAuthorization:!0},n||{},{method:"get",url:e}));return r={id:i,promise:l},o.push(r),l["finally"](function(){o.splice(o.indexOf(r),1)}),l},t}]),s.interceptors.push(["$injector","$rootScope","$q","$timeout",function(e,t,o,n){var a={};return{response:function(t){var i=o.defer();return e.get("EmployeeService").isInitializingFB()&&t.config.url.indexOf("a2bapp.com/api")>-1&&"Failed"==t.data.status&&"Missing valid apikey values."!=t.data.description?n(function(o){return t.config.url+="&"+e.get("ApiParamService").getParams(),a[t.config.url]=o,e.get("$http")(t.config)},3e3,!1,i):Object.keys(a).length>0&&a[t.config.url]?a[t.config.url].resolve(t):i.resolve(t),i.promise},responseError:function(n){return t.isOffline||500==n.status?o.reject(n):n.config.url.indexOf("a2bapp.com/api")>-1?e.get("$http")(n.config):void 0}}}]),r.state("app",{url:"/app","abstract":!0,templateUrl:"menu.html",controller:"AppCtrl"}).state("main",{url:"/main","abstract":!0,templateUrl:"main.html",controller:"AppCtrl"}).state("app.signup",{url:"/signup",guest:!0,cache:!1,views:{menuContent:{templateUrl:"signup.html",controller:"SignUpCtrl",controllerAs:"vm"}}}).state("app.intro",{url:"/intro",guest:!0,cache:!1,views:{menuContent:{templateUrl:"intro.html",controller:"IntroCtrl"}}}).state("app.login",{url:"/login:page",guest:!0,cache:!1,views:{menuContent:{templateUrl:"login.html",controller:"LoginCtrl"}}}).state("app.forgotpassword",{url:"/forgotpassword",guest:!0,cache:!1,views:{menuContent:{templateUrl:"forgot-password.html",controller:"ForgotPasswordCtrl"}}}).state("app.suspended",{url:"/suspended",cache:!1,views:{menuContent:{templateUrl:"suspended.html"}}}).state("app.employee-index",{url:"/queue",authenticate:!0,noCustomer:!0,cache:!1,views:{menuContent:{templateUrl:"employee-index.html",controller:"EmployeeIndexCtrl"}}}).state("app.forms",{url:"/forms",authenticate:!0,cache:!1,params:{vehicle:!0,permit:!0},views:{menuContent:{templateUrl:"forms.html",controller:"FormsCtrl"}}}).state("app.add-group",{url:"/addgroup/:id",authenticate:!0,onlyglobaldriver:!0,cache:!1,views:{menuContent:{templateUrl:"add-group.html",controller:"AddGroupCtrl"}}}).state("app.quoteform",{url:"/quote",cache:!1,quotepage:!0,views:{menuContent:{templateUrl:"quoteform.html",controller:"QuoteCtrl"}}}).state("app.orders",{url:"/orders/:apikey/:groupid",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"orders/index.html",controller:"OrdersCtrl"}}}).state("app.orders-detail",{url:"/order/:orderId",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"orders/detail.html",controller:"OrdersDetailCtrl"}}}).state("app.messages",{url:"/messages",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"messages/index.html",controller:"MessagesCtrl"}}}).state("app.messages-detail",{url:"/messages/:apikey/:name",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"messages/detail.html",controller:"MessagesDetailCtrl"}}}).state("app.employee-detail",{url:"/partners/:employeeId:driverId",authenticate:!0,onlydispatcher:!0,cache:!1,views:{menuContent:{templateUrl:"employee-detail.html",controller:"EmployeeDetailCtrl"}}}).state("app.trip-detail",{url:"/trip",authenticate:!0,intrip:!0,cache:!1,views:{menuContent:{templateUrl:"modals/trip-detail.html",controller:"TripDetailCtrl"}}}).state("app.driver-home",{url:"/home",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"employee-detail.html",controller:"EmployeeDetailCtrl"}}}).state("app.employee-orders",{url:"/partners/orders/:groupid/:zone_id/:apikey",cache:!1,views:{menuContent:{templateUrl:"orders/index.html",controller:"OrdersCtrl"}}}).state("app.employee-orderdetail",{url:"/order/:orderId/:zone_id/:inbox_id",cache:!1,views:{menuContent:{templateUrl:"orders/detail.html",controller:"OrdersDetailCtrl"}}}).state("app.employee-dispatcher",{url:"/partners/:employeeId/dispatcher",authenticate:!0,onlydispatcher:!0,cache:!1,views:{menuContent:{templateUrl:"employee-dispatcher.html",controller:"EmployeeDispatcherCtrl"}}}).state("app.dispatcher-form",{url:"/partners/:employeeId/dispatcher",authenticate:!0,onlyadmin:!0,cache:!1,params:{obj:null,type:null},views:{menuContent:{templateUrl:"dispatcher-form.html",controller:"DispatcherFormCtrl",controllerAs:"vm"}}}).state("app.driving",{url:"/driving",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"driving.html",controller:"EmployeeDrivingCtrl"}}}).state("app.poi",{url:"/poi",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"poi.html",controller:"EmployeePOICtrl"}}}).state("app.vehicle",{url:"/vehicle",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"vehicle.html",controller:"EmployeeVehicleCtrl"}}}).state("app.permit",{url:"/permit",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"permit.html",controller:"EmployeeDrivingCtrl"}}}).state("app.uploadpic",{url:"/uploadpic",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"upload-picture.html",controller:"EmployeePicCtrl"}}}).state("app.profile",{url:"/profile",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"my-profile.html"}}}).state("app.changepwd",{url:"/change_password",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"change-password.html",controller:"EmployeePasswordCtrl"}}}).state("app.groups",{url:"/groups",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"unsubscribe-groups.html",controller:"EmployeeGroupsCtrl"}}}).state("app.maps",{url:"/maps",cache:!1,authenticate:!0,hasmapaccess:!0,views:{menuContent:{templateUrl:"maps/index.html",controller:"MapListCtrl"}}}).state("app.maps-detail",{url:"/maps/:id",cache:!1,authenticate:!0,hasmapaccess:!0,params:{obj:null},views:{menuContent:{templateUrl:"maps/detail.html",controller:"MapsCtrl",controllerAs:"vm"}}}).state("app.contacts",{url:"/contacts",cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"contacts.html",controller:"ContactsCtrl"}}}).state("app.hrlist",{url:"/hr",cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"hr/index.html",controller:"OpportunitiesListCtrl"}}}).state("app.hrdetail",{url:"/hr",params:{obj:null},cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"hr/detail.html",controller:"OpportunitiesDetailCtrl"}}}).state("app.hrform",{url:"/hr",params:{obj:null},cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"hr/form.html",controller:"OpportunitiesFormCtrl"}}}).state("app.complaint",{url:"/help",cache:!1,views:{menuContent:{templateUrl:"complaint.html",controller:"ComplaintCtrl"}}}),l.otherwise(function(e){var t=e.get("$state"),o=e.get("$localStorage");o.isDriver?t.go("app.employee-index"):t.go("app.quoteform")})}]);