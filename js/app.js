var LHCChatOptions={};angular.module("starter",["ionic","starter.controllers","directory.services","directory.directives","ngCordova","firebase","ion-google-place","ionic.rating","ngMessages","ui.bootstrap.datetimepicker","ui.map","ngStorage","remoteValidation","ngCookies","pascalprecht.translate","toastr","timer","ui.validate","ion-autocomplete","monospaced.elastic","ionicLazyLoad","ngSanitize","naif.base64","jett.ionic.filter.bar","angularMoment","templates","Tek.progressBar","tabSlideBox","oc.lazyLoad","satellizer","720kb.socialshare"]).run(["$q","$cordovaLocalNotification","$interval","$localStorage","$ionicNavBarDelegate","Internet","$injector","$urlRouter","$cordovaSpinnerDialog","Initializer","$ionicSideMenuDelegate","$ionicHistory","$translate","$window","$cordovaGlobalization","$cordovaSplashscreen","$cordovaVibration","$timeout","GpsDetectService","ApiParamService","EmployeeService","$ionicPlatform","$rootScope","$state","AuthService","$ionicLoading","$cordovaNetwork","$cordovaGeolocation",function(e,t,o,n,a,i,r,l,s,c,p,u,d,m,h,f,g,v,w,C,y,b,L,O,S,U,D,x){L.platformReady=!1,v(function(){l.sync(),l.listen()}),$.fn.textWidth=function(){var e=$(this).html();$(this).html("<span>"+e+"</span>");var t=$(this).find("span:first").width();return $(this).html(e),t},L.history=u;var P;L.clearNotifIntv=function(){P&&(o.cancel(P),L.cancelLocalNotif(),P=null)},L.setLocalNotif=function(){L.platformReady&&ionic.Platform.isWebView()&&(P||(P=o(function(){L.cancelLocalNotif(function(){L.setLocalNotif()})},2e4)),t.schedule({id:1,at:moment().add(25,"seconds").toDate(),text:"A2B is not running",title:"A2B",icon:"icon"}).then(function(){}))},L.cancelLocalNotif=function(e){t.cancelAll().then(function(t){e&&e()})},L.customLoader=function(e,t){if(!(L.showingLoader&&!t||L.loadingMsg===e||L.isOffline)&&N){L.showingLoader=!0;var o=["SENDING"];e&&("string"==typeof e?(L.loadingMsg=e,o.push(e)):(L.loadingMsg=e.slice(0),o=o.concat(e))),d(o).then(function(t){var n=e?t[e]:t.SENDING;if(e){var a=[];o.slice(1).forEach(function(e){a.push(t[e])});var n=a.join(" ")}else var n=t.SENDING;L.showingLoader=!0,ionic.Platform.isWebView()?(s.hide(),s.show("",n,!0)):U.show({noBackdrop:!0,template:'<p class="item-icon-left">'+n+"<ion-spinner /></p>"})})}},L.hideLoader=function(){L.showingLoader=!1,L.loadingMsg=null,ionic.Platform.isWebView()&&s.hide(),U.hide()},L.showMsg=function(e,t){L.loadingMsg!=e&&L.hideLoader(),t?(U.show({template:e}),L.loadingMsg=e):d(e).then(function(t){U.show({template:t}),L.loadingMsg=e})},L.dontHideLoader=!1,L.isOffline=!1,L.isGpsOff=!1;L.isNetworkOn=function(){return ionic.Platform.isWebView()?D.isOnline():navigator.onLine},L.showLoader=!0,b.ready(function(){L.isOffline=!L.isNetworkOn(),L.platformReady=!0,y.setServerOffset(),window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),ionic.Platform.isWebView()&&(L.setLocalNotif(),f.show(),ionic.Platform.isAndroid()&&cordova.plugins.locationAccuracy.request(function(){},function(e){e.code!==cordova.plugins.locationAccuracy.ERROR_USER_DISAGREED&&window.confirm("Failed to automatically set Location Mode to 'High Accuracy'. Would you like to switch to the Location Settings page and do this manually?")&&cordova.plugins.diagnostic.switchToLocationSettings()},cordova.plugins.locationAccuracy.REQUEST_PRIORITY_HIGH_ACCURACY),b.registerBackButtonAction(function(e){e.preventDefault(),L.detail&&L.detail.isDriver&&"app.trip-detail"!=toState.name||navigator.app.backHistory()},101),window.addEventListener("native.keyboardshow",function(){L.keyboardopen=!0,v(function(){$(".fixedbtn, .footer-container").addClass("hidefooter"),$("ion-content").addClass("nobottom")})}),window.addEventListener("native.keyboardhide",function(){L.keyboardopen=!1,v(function(){$(".fixedbtn, .footer-container").removeClass("hidefooter"),$("ion-content").removeClass("nobottom")})}),document.addEventListener("offline",function(){k()},!1),document.addEventListener("online",function(){L.confirmConnection(!0)},!1),keepscreenon.enable(),cordova.plugins.backgroundMode.enable(),d(["APP_BACKGROUND_TITLE"]).then(function(e){cordova.plugins.backgroundMode.setDefaults({title:e.APP_BACKGROUND_TITLE,ticker:e.APP_BACKGROUND_TITLE,text:""})}),h.getPreferredLanguage().then(function(e){d.use(e.value.split("-")[0]).then(function(e){},function(e){})},function(e){}),document.addEventListener("resume",function(){L.$broadcast("onresume")},!1),document.addEventListener("pause",function(){L.$broadcast("onpause")},!1)),y.setLatLon(),c.mapsInitialized().then(function(){L.$broadcast("gmaps:loaded")}),y.autoBookIn(),y.networkListener()}),L.$on("loading:show",function(e,t,o){L.isOffline||L.isGpsOff||!L.showLoader||t&&t.hasOwnProperty("show")&&!t.show||L.customLoader(t&&t.text,o)}),L.$on("loading:hide",function(e,t){L.showLoader=!0,L.isOffline||L.isGpsOff||L.startupLoading||L.appoverdue||!t&&(L.dontHideLoader||0!==r.get("$http").pendingRequests.length&&!r.get("$http").pendingRequests.every(function(e){return!e.data||e.data&&!e.data.show}))||L.hideLoader()});var I,k=function(){y.cancelOfferTimeout(),y.clearAutoBookInt(),L.$broadcast("internet:offline"),L.isOffline=!0,ionic.Platform.isWebView()&&g.vibrate(500),L.showMsg("OFFLINE")},A=function(e){L.isOffline&&(L.isOffline=!1,L.$broadcast("internet:online"),L.isGpsOff?L.showMsg("GPS_OFF"):(L.hideLoader(),y.internetGPSReconnected()))};L.confirmConnection=function(t){if(t)return void callServ();if(I)return I.promise;return I=e.defer(),callServ=function(){v(function(){y.profile().then(function(){L.isNetworkOn()&&L.isOffline&&A(),I&&(I.resolve(),I=null)},function(){k(),v(function(){L.isNetworkOn()&&callServ()},1e4),I&&I.reject()})},100)},callServ(),I.promise},L.confirmConnection(),L.noGroups=!1,y.authenticateFirebase(),ionic.Platform.isWebView()||(L.isOffline&&L.showMsg("OFFLINE"),m.addEventListener("offline",function(){k()},!1),m.addEventListener("online",function(){L.confirmConnection(!0)},!1)),null!=window.localStorage.getItem("lat"),null!=window.localStorage.getItem("countryCode")&&(L.countryCode=window.localStorage.getItem("countryCode"));var E=!1;L.$on("firebaseInitialized",function(){E=!1}),ionic.Platform.isWebView()&&setTimeout(function(){},1e3);L.menuFunc=function(){},L.isNotCustomer=!0;var N=!1;L.$on("$stateChangeSuccess",function(e,t,o,n,a){v(function(){var e=L.history.currentTitle();e&&e==e.toUpperCase()?d(e).then(function(e){document.title=e}):document.title=e},700),t.formpage?L.clearNotifIntv():n.formpage&&L.setLocalNotif(),$("ion-side-menu")[0],N||setTimeout(function(){N=!0,ionic.Platform.isWebView()&&f.hide(),L.$broadcast("loading:show",{text:"WAIT"})},1500)}),L.$on("$stateChangeStart",function(e,t,o,n,a){if(L.showBookBtn=!0,L.onQuotePage=t.quotepage,"app.quoteform"!=t.name&&null!=document.querySelector(".ion-google-place-container")&&$(".ion-google-place-container").remove(),t.authenticate){if(!S.isAuthenticated())return L.noGroups?O.transitionTo("app.login"):O.transitionTo("app.quoteform"),void e.preventDefault();t.noCustomer&&!L.isNotCustomer&&e.preventDefault(),t.intrip&&!S.isInTrip()&&(O.transitionTo("app.employee-index"),e.preventDefault()),t.onlydispatcher&&S.isDispatcherAdmin(o,null,null,!0).then(function(t){t||(O.transitionTo("app.employee-index"),e.preventDefault())}),t.onlyadmin?S.isDispatcherAdmin(o,!0).then(function(t){t||(O.transitionTo("app.employee-index"),e.preventDefault())}):y.isInitializingFB()&&!E&&(E=!0,O.transitionTo("app.employee-index"),e.preventDefault()),t.hasmapaccess?L.isNotCustomer||(O.transitionTo("app.employee-index"),e.preventDefault()):t.onlyglobaldriver&&!L.globalDriver&&(O.transitionTo("app.employee-index"),e.preventDefault())}else(t.guest&&S.isAuthenticated()||"app.suspended"==t.name&&!L.app_suspended)&&(y.isDriver()?O.transitionTo("app.employee-index"):O.transitionTo("app.quoteform"),e.preventDefault());S.isAuthenticated()&&L.noGroups&&"app.add-group"!=t.name&&"app.employee-index"!=t.name&&e.preventDefault(),L.showFooter=!0}),moment.locale("en",{relativeTime:{future:"in %s",past:"%s ago",s:"%d sec",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"}})}]).config(["$authProvider","$provide","$ionicFilterBarConfigProvider","msdElasticConfig","$compileProvider","$ionicConfigProvider","$stateProvider","$urlRouterProvider","$httpProvider","$translateProvider","toastrConfig",function(e,t,o,n,a,i,r,l,s,c,p){var u={popupOptions:{location:"no",toolbar:"yes",width:window.screen.width,height:window.screen.height},responseType:"token"},d={},d={facebook:"705570759582781",google:"124877572507-8tllo02mjv7io5vdmmr86h64qliijj17.apps.googleusercontent.com",yahoo:"dj0yJmk9M2Fkb2FoQ1c0bm1jJmQ9WVdrOVVUaHROV05sTTJNbWNHbzlNQS0tJnM9Y29uc3VtZXJzZWNyZXQmeD02OQ--",instagram:"eab734484d7e480a943212d86794ad00"};ionic.Platform.isWebView()&&(d.facebook="1052030131517454",d.yahoo=""),ionic.Platform.isWebView()&&(e.cordova=!0,u.redirectUri="http://localhost/callback"),e.facebook(angular.extend({},u,{clientId:d.facebook})),e.yahoo(angular.extend({},u,{clientId:d.yahoo})),e.instagram(angular.extend({},u,{clientId:d.instagram})),e.google(angular.extend({},u,{clientId:d.google})),ionic.Platform.isAndroid()&&i.scrolling.jsScrolling(!0),a.imgSrcSanitizationWhitelist(/^\s*(https?|file|blob|cdvfile|content):|data:image\//),angular.extend(p,{timeOut:3e4,newestOnTop:!0,positionClass:"toast-top-full-width",preventOpenDuplicates:!0}),c.useStaticFilesLoader({prefix:"",suffix:".json"}),c.useSanitizeValueStrategy(null),c.useLocalStorage(),c.preferredLanguage("custom_locales/locale-en"),c.fallbackLanguage("locales/locale-en"),l.deferIntercept(),i.views.maxCache(0),i.form.toggle("large"),i.form.checkbox("circle"),i.templates.maxPrefetch(0),s.defaults.cache=!1;var m=3e4;t.decorator("$http",["$delegate",function(e){var t=e,o=[];return t.get=function(e,n){n=n||{timeout:m};var a="",i=e+JSON.stringify(n.params||{})+a;e.indexOf("a2bapp.com/api")>-1&&(e+="&_t="+Date.now());var r=_.find(o,{id:i});if(r)return r.promise;var l=t(angular.extend({skipAuthorization:!0},n||{},{method:"get",url:e}));return r={id:i,promise:l},o.push(r),l["finally"](function(){o.splice(o.indexOf(r),1)}),l},t}]),s.interceptors.push(["$injector","$rootScope","$q","$timeout",function(e,t,o,n){var a={};return{response:function(t){var i=o.defer();return e.get("EmployeeService").isInitializingFB()&&t.config.url.indexOf("a2bapp.com/api")>-1&&"Failed"==t.data.status&&t.data.description.indexOf("Missing")<0?n(function(o){return t.config.url+="&"+e.get("ApiParamService").getParams(),a[t.config.url]=o,e.get("$http")(t.config)},3e3,!1,i):Object.keys(a).length>0&&a[t.config.url]?a[t.config.url].resolve(t):i.resolve(t),i.promise},responseError:function(n){var a=o.defer();return t.isOffline||500==n.status?o.reject(n):n.config.url.indexOf("a2bapp.com/api")>-1&&n.config.url.indexOf("a2bapp.com/api/user")<0?(t.confirmConnection().then(a.resolve,a.reject),a.promise.then(function(){return e.get("$http")(n.config)},function(){return o.reject(n)})):o.reject(n)}}}]),r.state("app",{url:"/app","abstract":!0,templateUrl:"menu.html",controller:"AppCtrl"}).state("main",{url:"/main","abstract":!0,templateUrl:"main.html",controller:"AppCtrl"}).state("app.signup",{url:"/signup",guest:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"signup.html",controller:"SignUpCtrl",controllerAs:"vm"}}}).state("app.intro",{url:"/intro",guest:!0,cache:!1,views:{menuContent:{templateUrl:"intro.html",controller:"IntroCtrl"}}}).state("app.login",{url:"/login:page",guest:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"login.html",controller:"LoginCtrl"}}}).state("app.forgotpassword",{url:"/forgotpassword",guest:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"forgot-password.html",controller:"ForgotPasswordCtrl"}}}).state("app.suspended",{url:"/suspended",cache:!1,views:{menuContent:{templateUrl:"suspended.html"}}}).state("app.employee-index",{url:"/queue",authenticate:!0,noCustomer:!0,cache:!1,views:{menuContent:{templateUrl:"employee-index.html",controller:"EmployeeIndexCtrl"}}}).state("app.forms",{url:"/forms",authenticate:!0,cache:!1,params:{vehicle:!0,permit:!0},views:{menuContent:{templateUrl:"forms.html",controller:"FormsCtrl"}}}).state("app.add-group",{url:"/addgroup/:id",authenticate:!0,onlyglobaldriver:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"add-group.html",controller:"AddGroupCtrl",controllerAs:"vm"}}}).state("app.quoteform",{url:"/quote",cache:!1,quotepage:!0,mappage:!0,views:{menuContent:{templateUrl:"quoteform.html",controller:"QuoteCtrl"}}}).state("app.orders",{url:"/orders/:apikey/:groupid",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"orders/index.html",controller:"OrdersCtrl"}}}).state("app.orders-detail",{url:"/order/:orderId",authenticate:!0,cache:!1,mappage:!0,views:{menuContent:{templateUrl:"orders/detail.html",controller:"OrdersDetailCtrl"}}}).state("app.messages",{url:"/messages",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"messages/index.html",controller:"MessagesCtrl"}}}).state("app.messages-detail",{url:"/messages/:apikey/:name",authenticate:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"messages/detail.html",controller:"MessagesDetailCtrl"}}}).state("app.employee-detail",{url:"/partners/:employeeId:driverId",authenticate:!0,onlydispatcher:!0,mappage:!0,cache:!1,views:{menuContent:{templateUrl:"employee-detail.html",controller:"EmployeeDetailCtrl"}}}).state("app.trip-detail",{url:"/trip",authenticate:!0,intrip:!0,mappage:!0,cache:!1,views:{menuContent:{templateUrl:"modals/trip-detail.html",controller:"TripDetailCtrl"}}}).state("app.driver-home",{url:"/home",authenticate:!0,mappage:!0,cache:!1,views:{menuContent:{templateUrl:"employee-detail.html",controller:"EmployeeDetailCtrl"}}}).state("app.employee-orders",{url:"/partners/orders/:groupid/:zone_id/:apikey",cache:!1,views:{menuContent:{templateUrl:"orders/index.html",controller:"OrdersCtrl"}}}).state("app.employee-orderdetail",{url:"/order/:orderId/:zone_id/:inbox_id",cache:!1,mappage:!0,views:{menuContent:{templateUrl:"orders/detail.html",controller:"OrdersDetailCtrl"}}}).state("app.employee-dispatcher",{url:"/partners/:employeeId/dispatcher",authenticate:!0,onlydispatcher:!0,mappage:!0,cache:!1,views:{menuContent:{templateUrl:"employee-dispatcher.html",controller:"EmployeeDispatcherCtrl"}}}).state("app.dispatcher-form",{url:"/partners/:employeeId/dispatcher",authenticate:!0,onlyadmin:!0,cache:!1,formpage:!0,params:{obj:null,type:null},views:{menuContent:{templateUrl:"dispatcher-form.html",controller:"DispatcherFormCtrl",controllerAs:"vm"}}}).state("app.driving",{url:"/driving",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"driving.html",controller:"EmployeeDrivingCtrl"}}}).state("app.poi",{url:"/poi",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"poi.html",controller:"EmployeePOICtrl"}}}).state("app.vehicle",{url:"/vehicle",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"vehicle.html",controller:"EmployeeVehicleCtrl"}}}).state("app.permit",{url:"/permit",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"permit.html",controller:"EmployeeDrivingCtrl"}}}).state("app.uploadpic",{url:"/uploadpic",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"upload-picture.html",controller:"EmployeePicCtrl"}}}).state("app.profile",{url:"/profile",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"my-profile.html"}}}).state("app.changepwd",{url:"/change_password",authenticate:!0,cache:!1,formpage:!0,views:{menuContent:{templateUrl:"change-password.html",controller:"EmployeePasswordCtrl"}}}).state("app.groups",{url:"/groups",authenticate:!0,cache:!1,views:{menuContent:{templateUrl:"unsubscribe-groups.html",controller:"EmployeeGroupsCtrl"}}}).state("app.maps",{url:"/maps",cache:!1,authenticate:!0,hasmapaccess:!0,views:{menuContent:{templateUrl:"maps/index.html",controller:"MapListCtrl"}}}).state("app.maps-detail",{url:"/maps/:id",cache:!1,authenticate:!0,hasmapaccess:!0,params:{obj:null},views:{menuContent:{templateUrl:"maps/detail.html",controller:"MapsCtrl",controllerAs:"vm"}}}).state("app.contacts",{url:"/contacts",cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"contacts.html",controller:"ContactsCtrl"}}}).state("app.hrlist",{url:"/hr",cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"hr/index.html",controller:"OpportunitiesListCtrl"}}}).state("app.hrdetail",{url:"/hr",params:{obj:null},cache:!1,authenticate:!0,views:{menuContent:{templateUrl:"hr/detail.html",controller:"OpportunitiesDetailCtrl"}}}).state("app.hrform",{url:"/hr",params:{obj:null},cache:!1,authenticate:!0,formpage:!0,views:{menuContent:{templateUrl:"hr/form.html",controller:"OpportunitiesFormCtrl"}}}).state("app.complaint",{url:"/help",cache:!1,formpage:!0,views:{menuContent:{templateUrl:"complaint.html",controller:"ComplaintCtrl"}}}),l.otherwise(function(e){var t=e.get("$state"),o=e.get("$localStorage");o.isDriver?t.go("app.employee-index"):t.go("app.quoteform")})}]);